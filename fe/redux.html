<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reduxæºç é˜…è¯»ç¬”è®° | KSLEO</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.35aebc44.css" as="style"><link rel="preload" href="/assets/js/app.6f46cf57.js" as="script"><link rel="preload" href="/assets/js/2.49ce1412.js" as="script"><link rel="preload" href="/assets/js/19.118b3a66.js" as="script"><link rel="prefetch" href="/assets/js/10.86ad4e85.js"><link rel="prefetch" href="/assets/js/11.e7ef91a0.js"><link rel="prefetch" href="/assets/js/12.14d347b9.js"><link rel="prefetch" href="/assets/js/13.beaf8085.js"><link rel="prefetch" href="/assets/js/14.e42e08a4.js"><link rel="prefetch" href="/assets/js/15.41e8c95f.js"><link rel="prefetch" href="/assets/js/16.e8b84c5d.js"><link rel="prefetch" href="/assets/js/17.4d574f20.js"><link rel="prefetch" href="/assets/js/18.a8a8e164.js"><link rel="prefetch" href="/assets/js/20.ccdc0717.js"><link rel="prefetch" href="/assets/js/21.88ceead5.js"><link rel="prefetch" href="/assets/js/22.500d3be7.js"><link rel="prefetch" href="/assets/js/23.b7ca339b.js"><link rel="prefetch" href="/assets/js/24.0360313a.js"><link rel="prefetch" href="/assets/js/25.6083b636.js"><link rel="prefetch" href="/assets/js/26.1bd9d3eb.js"><link rel="prefetch" href="/assets/js/27.beb716dd.js"><link rel="prefetch" href="/assets/js/28.bb093ca6.js"><link rel="prefetch" href="/assets/js/29.5b527549.js"><link rel="prefetch" href="/assets/js/3.8a6c11df.js"><link rel="prefetch" href="/assets/js/30.796276de.js"><link rel="prefetch" href="/assets/js/31.666b101e.js"><link rel="prefetch" href="/assets/js/32.654129d9.js"><link rel="prefetch" href="/assets/js/33.e479db51.js"><link rel="prefetch" href="/assets/js/4.e2a8d64a.js"><link rel="prefetch" href="/assets/js/5.dd4c966a.js"><link rel="prefetch" href="/assets/js/6.00a6c78e.js"><link rel="prefetch" href="/assets/js/7.9330d48e.js"><link rel="prefetch" href="/assets/js/8.560dd961.js"><link rel="prefetch" href="/assets/js/9.da6c1180.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35aebc44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KSLEO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="reduxæºç é˜…è¯»ç¬”è®°"><a href="#reduxæºç é˜…è¯»ç¬”è®°" class="header-anchor">#</a> Reduxæºç é˜…è¯»ç¬”è®°</h1> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>ä¹‹å‰å¯¹reduxæœ‰ä¸€äº›ç®€å•çš„åº”ç”¨ï¼Œå¹¶ä¸”å¤§è‡´ç†è§£reduxçš„æ•´ä½“è®¾è®¡ï¼Œå‡ºäºæ·±å…¥äº†è§£çš„ç›®çš„è¯»ä¸€ä¸‹æºç ã€‚å› æ­¤æœ¬æ–‡ä¸è®¾è®¡ä»»ä½•reduxçš„æ¦‚å¿µè§£é‡Šä»¥åŠç”¨æ³•ä»‹ç»ï¼Œä»…å¯¹æºä»£ç åšä¸€ä¸ªé€»è¾‘æ•´ç†ã€‚</p> <h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="header-anchor">#</a> ç›®å½•ç»“æ„</h2> <p>Reduxçš„ç›®å½•ç»“æ„å’Œä»£ç éƒ½æ¯”è¾ƒç®€æ´ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹</p> <div class="language- extra-class"><pre><code>/src
â”œâ”€â”€ applyMiddleware.ts
â”œâ”€â”€ bindActionCreators.ts
â”œâ”€â”€ combineReducers.ts
â”œâ”€â”€ compose.ts
â”œâ”€â”€ createStore.ts
â”œâ”€â”€ index.ts
â”œâ”€â”€ types
â”‚Â Â  â”œâ”€â”€ actions.ts
â”‚Â Â  â”œâ”€â”€ middleware.ts
â”‚Â Â  â”œâ”€â”€ reducers.ts
â”‚Â Â  â””â”€â”€ store.ts
â””â”€â”€ utils
    â”œâ”€â”€ actionTypes.ts
    â”œâ”€â”€ isPlainObject.ts
    â”œâ”€â”€ symbol-observable.ts
    â””â”€â”€ warning.ts
</code></pre></div><p>æ¥ç€çœ‹ä¸€ä¸‹rollupçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒé…ç½®äº†ä¸‰ç§ç§æ¨¡å—è¾“å‡ºï¼šCommonJSã€ESã€UMDã€‚rollupçš„ä½¿ç”¨ä¸åœ¨è¿™ç¯‡ç¬”è®°çš„è®¨è®ºèŒƒå›´å†…ï¼Œè¿™é‡Œä¸»è¦ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹å…¥å£æ–‡ä»¶åœ¨å“ªé‡Œã€‚é…ç½®æ–‡ä»¶è¡¨æ˜Reduxçš„å…¥å£æ–‡ä»¶æ˜¯<code>src/index.ts</code>ã€‚æ‰“å¼€è¯¥æ–‡ä»¶çœ‹çœ‹é‡Œé¢çš„å†…å®¹ï¼Œå‘ç°å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†å…¶ä»–æ–‡ä»¶ä¸­çš„æ¨¡å—è¿›è¡Œæ•´åˆç„¶åç»Ÿä¸€å¯¼å‡ºã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// types</span>
<span class="token comment">// store</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
  CombinedState<span class="token punctuation">,</span>
  PreloadedState<span class="token punctuation">,</span>
  Dispatch<span class="token punctuation">,</span>
  Unsubscribe<span class="token punctuation">,</span>
  Observable<span class="token punctuation">,</span>
  Observer<span class="token punctuation">,</span>
  Store<span class="token punctuation">,</span>
  StoreCreator<span class="token punctuation">,</span>
  StoreEnhancer<span class="token punctuation">,</span>
  StoreEnhancerStoreCreator<span class="token punctuation">,</span>
  ExtendState
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types/store'</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>index.ts</code>çš„å·¥ä½œå°±æ˜¯è¿™äº›ï¼Œæ•´åˆå¹¶ç»Ÿä¸€å¯¼å‡ºæ¨¡å—ã€‚</p> <p>å¹³æ—¶ä½¿ç”¨Reduxæ—¶æˆ‘ä»¬åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„APIæ˜¯<code>createStore</code>ã€<code>combineReducers</code>ã€<code>applyMiddlewares</code>ç­‰ã€‚æ¥ä¸‹æ¥ä¸€ä¸€æŸ¥çœ‹è¿™äº›APIçš„æºç ã€‚</p> <h3 id="createstore"><a href="#createstore" class="header-anchor">#</a> <code>createStore</code></h3> <p><code>createStore</code>ç”¨æ¥åˆ›å»ºä¸€ä¸ªstoreå®ä¾‹ã€‚å®ƒçš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> createStore<span class="token operator">&lt;</span>
  <span class="token constant">S</span><span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token punctuation">,</span>
  Ext <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  StateExt <span class="token operator">=</span> <span class="token builtin">never</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  enhancer<span class="token operator">?</span><span class="token operator">:</span> StoreEnhancer<span class="token operator">&lt;</span>Ext<span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
<span class="token keyword">function</span> createStore<span class="token operator">&lt;</span>
  <span class="token constant">S</span><span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token punctuation">,</span>
  Ext <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  StateExt <span class="token operator">=</span> <span class="token builtin">never</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  preloadedState<span class="token operator">?</span><span class="token operator">:</span> PreloadedState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  enhancer<span class="token operator">?</span><span class="token operator">:</span> StoreEnhancer<span class="token operator">&lt;</span>Ext<span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
<span class="token keyword">function</span> createStore<span class="token operator">&lt;</span>
  <span class="token constant">S</span><span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token punctuation">,</span>
  Ext <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  StateExt <span class="token operator">=</span> <span class="token builtin">never</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  preloadedState<span class="token operator">?</span><span class="token operator">:</span> PreloadedState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span> <span class="token operator">|</span> StoreEnhancer<span class="token operator">&lt;</span>Ext<span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  enhancer<span class="token operator">?</span><span class="token operator">:</span> StoreEnhancer<span class="token operator">&lt;</span>Ext<span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>ç­¾åæœ‰äº›é•¿ï¼Œå¹¶ä¸”æœ‰é‡è½½å®šä¹‰ã€‚åªæ‹¿å‡ºå…¶ä¸­ä¸€ä¸ªå®ç°æ¥çœ‹ï¼š</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> createStore<span class="token operator">&lt;</span>
  <span class="token constant">S</span><span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token punctuation">,</span>
  Ext <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  StateExt <span class="token operator">=</span> <span class="token builtin">never</span>
<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  preloadedState<span class="token operator">?</span><span class="token operator">:</span> PreloadedState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  enhancer<span class="token operator">?</span><span class="token operator">:</span> StoreEnhancer<span class="token operator">&lt;</span>Ext<span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>createStore</code>å®šä¹‰äº†å››ä¸ªèŒƒå‹å˜é‡ï¼Œå®ƒä»¬çš„å«ä¹‰åˆ†åˆ«æ˜¯</p> <ul><li>S: å®ä¾‹åŒ–çš„storeå­˜å‚¨çš„æ•°æ®ç±»å‹ã€‚</li> <li>A: å®ä¾‹åŒ–çš„storeæœªæ¥å°†è¦dispatchçš„actionç±»å‹ã€‚</li> <li>Ext: store enhancerè¿”å›çš„storeæ‰©å±•ã€‚</li> <li>StateExt: store enhancerè¿”å›çš„stateæ‰©å±•ã€‚</li></ul> <p>è¿™ä¸ªstore enhancerå¯ä»¥ç†è§£ä¸ºç»™storeé¢å¤–æ·»åŠ ä¸€äº›åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æœ‰å¯èƒ½ä¼šæ”¹å˜dispatchå’Œreducerçš„å·¥ä½œæµç¨‹ã€‚æ¯”å¦‚ä¸ºreduxæ³¨å†Œä¸­é—´ä»¶ï¼Œå°±æ˜¯enhancerã€‚æ€»ä¹‹æ˜¯è¿”å›ä¸€ä¸ªåŠŸèƒ½æ‰©å±•ç‰ˆæœ¬çš„storeå®ä¾‹ã€‚</p> <p><code>createStore</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚</p> <ul><li>reducer: reducerå‡½æ•°ã€‚æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ›´æ–°storeçš„é€»è¾‘å†™åœ¨è¿™ä¸ªå‡½æ•°ä¸­ã€‚</li> <li>prelaodedState: åˆå§‹åŒ–çš„stateã€‚å¦‚æœä½¿ç”¨äº†<code>combineReducers</code>æ¥ç”Ÿæˆ<code>reducer</code>ï¼Œé‚£è¿™ä¸ªå¯¹è±¡å¿…é¡»å’Œ<code>combineReducers</code>æœ‰ä¸€æ ·çš„keyã€‚æ˜¯å¯é€‰å‚æ•°</li> <li>enhancer: å¯¹storeçš„å¢å¼ºæ‰©å±•ï¼Œæ˜¯å¯é€‰å‚æ•°ã€‚</li></ul> <p><code>createStore</code>è¿”å›ä¸€ä¸ª<code>Store</code>å’Œ<code>Ext</code>çš„äº¤å‰ç±»å‹ã€‚å³æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„storeå®ä¾‹çš„ç±»å‹ã€‚</p> <h4 id="å‡½æ•°é€»è¾‘"><a href="#å‡½æ•°é€»è¾‘" class="header-anchor">#</a> å‡½æ•°é€»è¾‘</h4> <p>å‡½æ•°å¼€å¤´æ˜¯ä¸€äº›å‚æ•°çš„å®‰å…¨æ€§æ£€æŸ¥ã€‚å…¶ä¸­è¿™ä¸€æ®µæ¯”è¾ƒé‡è¦ï¼š</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> enhancer <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> enhancer <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Expected the enhancer to be a function.'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">enhancer</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>
      reducer<span class="token punctuation">,</span>
      preloadedState <span class="token keyword">as</span> PreloadedState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span> <span class="token keyword">as</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ£€æŸ¥<code>enhancer</code>å‚æ•°çš„åˆæ³•æ€§ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåˆæ³•çš„enhancerï¼Œåˆ™ç”¨å®ƒæ¥ç”Ÿæˆæœ€ç»ˆçš„storeå®ä¾‹ã€‚</p> <p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›<code>store</code>å®ä¾‹æ–¹æ³•çš„å®šä¹‰ã€‚</p> <h5 id="getstate"><a href="#getstate" class="header-anchor">#</a> <code>getState</code></h5> <p>è¿”å›å½“å‰çš„stateæ•°æ®ã€‚è¿™ä¸ªå‡½æ•°ä¸­åšäº†ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœå½“å‰æœ‰æ­£åœ¨è¿›è¡Œçš„dispatchæ“ä½œï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p> <h5 id="subscribe"><a href="#subscribe" class="header-anchor">#</a> <code>subscribe</code></h5> <p>ç”¨æ¥è®¢é˜…storeçš„æ›´æ–°ã€‚å½“dispatchæ—¶ï¼Œè®¢é˜…æ–¹ä¼šè¢«å‘ŠçŸ¥ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå½“å‰è®¢é˜…æ–¹çš„è®¢é˜…è§£é™¤ã€‚</p> <h5 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> <code>dispatch</code></h5> <p>æœ€é‡è¦çš„æ–¹æ³•ä¹‹ä¸€<code>dispatch</code>åœ¨è¿™é‡Œå®šä¹‰ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        isDispatching <span class="token operator">=</span> <span class="token boolean">true</span>
        currentState <span class="token operator">=</span> <span class="token function">currentReducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        isDispatching <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token punctuation">(</span>currentListeners <span class="token operator">=</span> nextListeners<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> listeners<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> listener <span class="token operator">=</span> listeners<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 

    <span class="token keyword">return</span> action
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>é¦–å…ˆå°†<code>isDispatching</code>æ ‡è®°ä¸ºtrueï¼Œè¡¨ç¤ºæ­£åœ¨æ‰§è¡Œdispatchï¼Œå…¶ä»–æ“ä½œéƒ½ä¸å¯è¢«æ‰§è¡Œï¼Œdispatchå®Œæ¯•åï¼Œå†å°†å…¶è®¾ç½®ä¸ºfalseã€‚æ¥ä¸‹æ¥è¯»å–æ‰€æœ‰çš„listenersï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œã€‚æœ€åå°†actionè¿”å›ã€‚</p> <h5 id="replacereducer"><a href="#replacereducer" class="header-anchor">#</a> <code>replaceReducer</code></h5> <p>è¿™ä¸ªå‡½æ•°ç”¨æ¥æ›´æ–°å½“å‰storeå®ä¾‹çš„æ ¹reducerã€‚</p> <h5 id="observable"><a href="#observable" class="header-anchor">#</a> <code>observable</code></h5> <p>å¯è§‚æµ‹è®¢é˜…æ–¹æ³•çš„æœ€ç®€å®ç°ã€‚ç”¨äºç›‘å¬storeçš„å˜åŒ–ï¼Œè§¦å‘äº‹ä»¶æµã€‚è®¢é˜…è€…éœ€è¦æä¾›nextæ–¹æ³•æ‰ä¼šè®¢é˜…æˆåŠŸï¼Œå¯ä»¥çœ‹å‡ºæ˜¯æƒ³é€šè¿‡ä¸€ç§ç±»ä¼¼äºè¿­ä»£å™¨çš„åŠŸèƒ½å®ç°è®¢é˜…çš„è‡ªåŠ¨å‘å¸ƒã€‚åŒæ—¶è¿˜ä½¿ç”¨åˆ°äº†Symbolå¯¹è±¡ä¸Šçš„observableå±æ€§ã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> outerSubscribe <span class="token operator">=</span> subscribe <span class="token comment">// storeå®ä¾‹æ–¹æ³•ä¸Šçš„subscribe</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">observer<span class="token operator">:</span> <span class="token builtin">unknown</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> observer <span class="token operator">!==</span> <span class="token string">'object'</span> <span class="token operator">||</span> observer <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Expected the observer to be an object.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">observeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> observerAsObserver <span class="token operator">=</span> observer <span class="token keyword">as</span> Observer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>observerAsObserver<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            observerAsObserver<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">observeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> <span class="token function">outerSubscribe</span><span class="token punctuation">(</span>observeState<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> unsubscribe <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token punctuation">[</span>$$observable<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>æœ€åï¼Œ<code>createStore</code>æ–¹æ³•dispatchä¸€ä¸ª<code>init action</code>ï¼Œç„¶åæŠŠè¿™äº›å±æ€§ç»„åˆï¼Œè¿”å›storeå®ä¾‹ï¼Œ<code>createStore</code>æ‰§è¡Œç»“æŸã€‚</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span> <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">A</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        dispatch<span class="token operator">:</span> dispatch <span class="token keyword">as</span> Dispatch<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        subscribe<span class="token punctuation">,</span>
        getState<span class="token punctuation">,</span>
        replaceReducer<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>$$observable<span class="token punctuation">]</span><span class="token operator">:</span> observable
    <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Store<span class="token operator">&lt;</span>ExtendState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> StateExt<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> StateExt<span class="token punctuation">,</span> Ext<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Ext
<span class="token keyword">return</span> store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="applymiddleware"><a href="#applymiddleware" class="header-anchor">#</a> <code>applyMiddleware</code></h3> <p>ä¹‹å‰åœ¨<code>createStore</code>å‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªenhancerå‚æ•°æ£€æµ‹çš„é€»è¾‘ï¼Œå®ƒå¯ä»¥å¯¹storeè¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œå¹¶ä¸”å°†storeå®ä¾‹çš„ç”Ÿæˆç§»äº¤ç»™å®ƒå¤„ç†ã€‚è€Œä½œä¸ºreduxæ¥è¯´ï¼Œå®ƒåªæä¾›äº†ä¸€ç§enhancerâ€”â€”<code>applyMiddleware</code>ã€‚</p> <p>å®ƒçš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>middlewares<span class="token operator">:</span> Middleware<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> StoreEnhancer<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ¥æ”¶ä¸€ä¸ªä¸­é—´ä»¶æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªenhancerå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¼šä¼ ç»™<code>createStore</code>ï¼Œç„¶åè¿›å…¥<code>createStore</code>å†…éƒ¨çš„enhanceré€»è¾‘ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f46cf57.js" defer></script><script src="/assets/js/2.49ce1412.js" defer></script><script src="/assets/js/19.118b3a66.js" defer></script>
  </body>
</html>
