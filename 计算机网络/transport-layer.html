<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>传输层 | KSLEO</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.35aebc44.css" as="style"><link rel="preload" href="/assets/js/app.6f46cf57.js" as="script"><link rel="preload" href="/assets/js/2.49ce1412.js" as="script"><link rel="preload" href="/assets/js/33.e479db51.js" as="script"><link rel="prefetch" href="/assets/js/10.86ad4e85.js"><link rel="prefetch" href="/assets/js/11.e7ef91a0.js"><link rel="prefetch" href="/assets/js/12.14d347b9.js"><link rel="prefetch" href="/assets/js/13.beaf8085.js"><link rel="prefetch" href="/assets/js/14.e42e08a4.js"><link rel="prefetch" href="/assets/js/15.41e8c95f.js"><link rel="prefetch" href="/assets/js/16.e8b84c5d.js"><link rel="prefetch" href="/assets/js/17.4d574f20.js"><link rel="prefetch" href="/assets/js/18.a8a8e164.js"><link rel="prefetch" href="/assets/js/19.118b3a66.js"><link rel="prefetch" href="/assets/js/20.ccdc0717.js"><link rel="prefetch" href="/assets/js/21.88ceead5.js"><link rel="prefetch" href="/assets/js/22.500d3be7.js"><link rel="prefetch" href="/assets/js/23.b7ca339b.js"><link rel="prefetch" href="/assets/js/24.0360313a.js"><link rel="prefetch" href="/assets/js/25.6083b636.js"><link rel="prefetch" href="/assets/js/26.1bd9d3eb.js"><link rel="prefetch" href="/assets/js/27.beb716dd.js"><link rel="prefetch" href="/assets/js/28.bb093ca6.js"><link rel="prefetch" href="/assets/js/29.5b527549.js"><link rel="prefetch" href="/assets/js/3.8a6c11df.js"><link rel="prefetch" href="/assets/js/30.796276de.js"><link rel="prefetch" href="/assets/js/31.666b101e.js"><link rel="prefetch" href="/assets/js/32.654129d9.js"><link rel="prefetch" href="/assets/js/4.e2a8d64a.js"><link rel="prefetch" href="/assets/js/5.dd4c966a.js"><link rel="prefetch" href="/assets/js/6.00a6c78e.js"><link rel="prefetch" href="/assets/js/7.9330d48e.js"><link rel="prefetch" href="/assets/js/8.560dd961.js"><link rel="prefetch" href="/assets/js/9.da6c1180.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35aebc44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KSLEO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/directory/" class="nav-link">
  笔记📒
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客🔗
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/directory/" class="nav-link">
  笔记📒
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客🔗
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="传输层"><a href="#传输层" class="header-anchor">#</a> 传输层</h1> <p>TCP/IP协议簇中的传输层位于应用层和网络层之间。为应用层提供服务，接收来自网络层的服务。传输层是客户端程序和服务器程序的联络人，是进程到进程的连接。传输层是TCP/IP的核心；是互联网点到点交换数据的逻辑媒介。</p> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>传输层在两个应用层之间提供进程到进程的服务，一个进程在本地，另一个在远程主机。两个应用层存在一条假想的直接逻辑链路。传输层为应用层提供了两种可用协议。一种是UDP，一种是TCP。UDP提供不可靠、无连接的服务，TCP提供可靠、面向连接的服务。应用层程序必须指明使用哪一种运输层协议。</p> <p>UDP和TCP的基本职责是，将两个端系统间IP的交付服务扩展为运行在端系统上的两个进程之间的交付服务。将主机间交付扩展到进程间交付被称为运输层的<strong>多路复用</strong>（multiplexing）和<strong>多路分解</strong>（demultiplexing）。UDP和TCP还可以提供报文的完整性检查。进程间的数据交付和差错校验是运输层提供的最低限度的服务，也是UDP仅能提供的两种服务。TCP则提供了多种附加服务，比如可靠数据传输、拥塞控制等。</p> <h2 id="多路复用和多路分解"><a href="#多路复用和多路分解" class="header-anchor">#</a> 多路复用和多路分解</h2> <p>将运输层报文段中的数据交付到正确的套接字的工作称为<strong>多路分解</strong>。在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息生成报文，然后将报文传递到网络层，这些工作称为<strong>多路复用</strong>。</p> <p>我们使用IP来定义主机。为了定义和标识进程，我们需要第二个标识符，称为端口号。在TCP/IP协议簇中，端口号是16位整数（0～65535）。</p> <p>客户端程序使用端口号定义自己，这属于临时端口号，因为它只在客户端程序运行期间短暂存在。临时端口号推荐大于1023。</p> <p>服务器进程必须使用一个端口号定义自己。但这个端口号不能随意选择。TCP/IP使用全局端口号，又称<strong>熟知端口号（well-known port number）</strong>。</p> <p>在与终端通信时，IP和端口号起着不同的作用。IP地址用来确定唯一主机，端口号确定该主机上的唯一进程。</p> <p>ICANN把端口号编码划分为三种范围：</p> <ol><li>熟知端口。0～1023，由ICANN分配和控制。</li> <li>注册端口。1024～49151。ICANN不分配不控制，可在ICANN注册以防止重复。</li> <li>动态端口。49152～65535。不受控制也不需要注册，任何进程都可以使用。</li></ol> <h3 id="无连接的多路复用和多路分解"><a href="#无连接的多路复用和多路分解" class="header-anchor">#</a> 无连接的多路复用和多路分解</h3> <p>UDP套接字由二元组构成（目的IP地址、目的端口号）。发送方为UDP报文写入目的端口号、源端口号后，交给网络层转发。接收方收到多个UDP报文时，通过提取首部的目的端口号，将数据交给对应的套接字进程。</p> <h3 id="面向连接的多路复用和分解"><a href="#面向连接的多路复用和分解" class="header-anchor">#</a> 面向连接的多路复用和分解</h3> <p>TCP套接字由四元组构成（源IP地址、源端口号、目的IP地址、目的端口号）。当一个TCP报文到达，接收方通过全部4个字段来确认唯一套接字并交付数据。与UDP不同的点在于，如果两个TCP报文源IP或者源端口不同，TCP可能会将数据交给不同的套接字处理，因为TCP是面向连接的。</p> <h2 id="无连接运输udp"><a href="#无连接运输udp" class="header-anchor">#</a> 无连接运输UDP</h2> <p>UDP仅仅对IP协议做了很小的扩展——差错校验和复用/分解。使用UDP发送报文前，发送方和接收方的运输层实体之间没有握手。因此UDP被称为是无连接的。</p> <h3 id="udp报文结构"><a href="#udp报文结构" class="header-anchor">#</a> UDP报文结构</h3> <p>UDP报文由首部和数据部分组成。UDP首部只有四个字段：源端口号、目的端口号、长度、校验和。</p> <h3 id="udp校验和"><a href="#udp校验和" class="header-anchor">#</a> UDP校验和</h3> <p>发送方的UDP对报文段中的所有16比特序列的和进行反码计算，求和时高位溢出会被回卷到低位，计算的结果存入校验和字段。在接收方，将16比特序列再进行加法运算，如果没有差错，则结果应该是全1。UDP实现差错校验是基于端到端原则，该原则表述为因为某种功能必须基于端到端实现，与较高级别协议提供这些功能相比，在较低级别上设置的功能可能是荣誉或者几乎没有价值的。UDP能校验差错，但不能纠错。UDP只能丢弃出错的报文，或者交给应用程序自行处理。</p> <h2 id="可靠数据传输机制"><a href="#可靠数据传输机制" class="header-anchor">#</a> 可靠数据传输机制</h2> <ul><li><p>校验和</p> <p>用于检测一个传输分组中的比特流错误</p></li> <li><p>定时器</p> <p>用于超时/重传一个分组。可能因为该分组（或其ACK）在信道中丢失了。接收方可能接收到同一个分组的冗余副本。</p></li> <li><p>序号</p> <p>用于数据流按顺序编号，接收分组的序号间隙可使接收方检测分组丢失。相同序号的分组可以让接收方检测到冗余副本。</p></li> <li><p>确认</p> <p>接收方告知发送方一个分组被正确接收。确认报文通常携带被确认分组的序号。确认可以是逐个，也可以是累积。</p></li> <li><p>否定确认</p> <p>接收方告知发送方某个分组未被正确接收。否定报文通常携带未被正确接收的分组序号。</p></li> <li><p>滑动窗口、流水线</p> <p>发送方被限制仅发送落在窗口内的分组。允许一次发送多个分组但未被确认，发送方的利用率在停等协议的基础上被增加。窗口长度可以根据吞吐量、网络拥塞情况来动态设置。</p></li></ul> <h2 id="面向连接的运输tcp"><a href="#面向连接的运输tcp" class="header-anchor">#</a> 面向连接的运输TCP</h2> <h3 id="tcp连接"><a href="#tcp连接" class="header-anchor">#</a> TCP连接</h3> <p>TCP连接没有物理实体，属于逻辑线路。TCP协议只在端系统中允许，所以中间的网络设备（路由器、交换机）不会维持TCP连接状态。路由器对TCP对连接完全视而不见，它看到的只是数据报。TCP连接是点对点的，因此不具备多播功能。</p> <p>客户端发送一个特殊的TCP报文段，服务器用另一个特殊的报文段相应，最后客户端用第三个特殊报文段相应。前两个报文段不包含应用层数据；第三个报文段可以承载应用层数据。由于连接过程发送了三个报文段，所以这种连接过程被称为<strong>三次握手（three-way handshake）</strong>。</p> <p>TCP连接建立后，两个远程进程就可以通信了。TCP将应用层的数据引导至<strong>发送缓冲区</strong>（send buffer），发送缓冲区是三次握手期间创建的缓冲区之一。TCP会从缓冲区取数据发送到网络层。TCP从缓冲区读取的数据长度受限于<strong>最大报文段长度（Maximum Segment Size，MSS）</strong>。MSS通常根据本地主机的最大链路层帧长度（即<strong>最大传输单元（Maximum Transmission Unit，MTU）</strong>）来设置。以太网和PPP链路层协议都具有1500字节的MTU，因此MSS的值一般设置为1460（为TCP/IP首部预留40字节位置）。</p> <p>TCP为每块数据追加一个TCP首部，从而形成多个<strong>TCP报文段</strong>（TCP segment），这些报文段下发给网络层后，封装成IP数据报发送到网络中。TCP接收到一个报文段后，将其放入接收缓冲区，应用程序可以通过缓冲区读取数据。</p> <h3 id="tcp报文结构"><a href="#tcp报文结构" class="header-anchor">#</a> TCP报文结构</h3> <p>TCP报文由首部和数据字段构成。首部包括：</p> <ul><li>源端口号。</li> <li>目的端口号。</li> <li></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f46cf57.js" defer></script><script src="/assets/js/2.49ce1412.js" defer></script><script src="/assets/js/33.e479db51.js" defer></script>
  </body>
</html>
