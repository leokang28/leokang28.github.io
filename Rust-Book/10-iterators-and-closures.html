<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 10 - Functional Language Features: Iterators and Closures | KSLEO</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.35aebc44.css" as="style"><link rel="preload" href="/assets/js/app.6f46cf57.js" as="script"><link rel="preload" href="/assets/js/2.49ce1412.js" as="script"><link rel="preload" href="/assets/js/15.41e8c95f.js" as="script"><link rel="prefetch" href="/assets/js/10.86ad4e85.js"><link rel="prefetch" href="/assets/js/11.e7ef91a0.js"><link rel="prefetch" href="/assets/js/12.14d347b9.js"><link rel="prefetch" href="/assets/js/13.beaf8085.js"><link rel="prefetch" href="/assets/js/14.e42e08a4.js"><link rel="prefetch" href="/assets/js/16.e8b84c5d.js"><link rel="prefetch" href="/assets/js/17.4d574f20.js"><link rel="prefetch" href="/assets/js/18.a8a8e164.js"><link rel="prefetch" href="/assets/js/19.118b3a66.js"><link rel="prefetch" href="/assets/js/20.ccdc0717.js"><link rel="prefetch" href="/assets/js/21.88ceead5.js"><link rel="prefetch" href="/assets/js/22.500d3be7.js"><link rel="prefetch" href="/assets/js/23.b7ca339b.js"><link rel="prefetch" href="/assets/js/24.0360313a.js"><link rel="prefetch" href="/assets/js/25.6083b636.js"><link rel="prefetch" href="/assets/js/26.1bd9d3eb.js"><link rel="prefetch" href="/assets/js/27.beb716dd.js"><link rel="prefetch" href="/assets/js/28.bb093ca6.js"><link rel="prefetch" href="/assets/js/29.5b527549.js"><link rel="prefetch" href="/assets/js/3.8a6c11df.js"><link rel="prefetch" href="/assets/js/30.796276de.js"><link rel="prefetch" href="/assets/js/31.666b101e.js"><link rel="prefetch" href="/assets/js/32.654129d9.js"><link rel="prefetch" href="/assets/js/33.e479db51.js"><link rel="prefetch" href="/assets/js/4.e2a8d64a.js"><link rel="prefetch" href="/assets/js/5.dd4c966a.js"><link rel="prefetch" href="/assets/js/6.00a6c78e.js"><link rel="prefetch" href="/assets/js/7.9330d48e.js"><link rel="prefetch" href="/assets/js/8.560dd961.js"><link rel="prefetch" href="/assets/js/9.da6c1180.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35aebc44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KSLEO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-10-functional-language-features-iterators-and-closures"><a href="#chapter-10-functional-language-features-iterators-and-closures" class="header-anchor">#</a> Chapter 10 - Functional Language Features: Iterators and Closures</h1> <p>Rustçš„çµæ„Ÿæ¥è‡ªäºç°æœ‰çš„è®¸å¤šè¯­è¨€å’ŒæŠ€æœ¯ï¼Œå…¶ä¸­ä¸€ä¸ªæœ€é‡è¦çš„æ¦‚å¿µå°±æ˜¯<em>å‡½æ•°å¼ç¼–ç¨‹ï¼ˆfunctional programmingï¼‰</em>ã€‚å‡½æ•°å¼ç¼–ç¨‹åŒ…æ‹¬ï¼ŒæŠŠå‡½æ•°å½“ä½œå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼›ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ï¼›æŠŠå‡½æ•°èµ‹å€¼ç»™å˜é‡å»¶è¿Ÿè°ƒç”¨ã€‚</p> <p>ä¸‹é¢ä¼šä»‹ç»ä¸€äº›è·Ÿå…¶ä»–å‡½æ•°å¼è¯­è¨€ç±»ä¼¼çš„æ¦‚å¿µï¼š</p> <ul><li>é—­åŒ…ï¼Œç»“æ„ç±»ä¼¼äºå‡½æ•°ï¼Œå¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚</li> <li>è¿­ä»£å™¨ï¼Œå¤„ç†ä¸€ç³»åˆ—æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚</li> <li>è¿™ä¸¤è€…çš„æ€§èƒ½ã€‚</li></ul> <h2 id="section-1-closures-anonymous-functions-that-can-capture-their-environment"><a href="#section-1-closures-anonymous-functions-that-can-capture-their-environment" class="header-anchor">#</a> Section 1 - Closures: Anonymous Functions that Can Capture Their Environment</h2> <p>Rustçš„é—­åŒ…æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä½ å¯ä»¥æŠŠå®ƒå­˜è¿›å˜é‡æˆ–è€…å½“ä½œå‚æ•°ä¼ ç»™å…¶ä»–å‡½æ•°ã€‚é—­åŒ…çš„å®šä¹‰å’Œè°ƒç”¨å¯ä»¥åœ¨ä¸åŒæ—¶é—´ç‚¹ï¼Œä¸åŒä¸Šä¸‹æ–‡ä¸­ã€‚è·Ÿå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œé—­åŒ…å¯ä»¥æ•è·ä»–ä»¬å®šä¹‰æ‰€åœ¨ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡ã€‚</p> <p>ä¾‹å¦‚æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šè¦å¼€å‘ä¸€ä¸ªappæ¥ä¸ºç”¨æˆ·ç”Ÿæˆè‡ªå®šä¹‰çš„è®­ç»ƒè®¡åˆ’ã€‚åå°ä½¿ç”¨Rustï¼Œç”Ÿæˆç®—æ³•è€ƒè™‘äº†å¾ˆå¤šå› ç´ ï¼Œä¾‹å¦‚ç”¨æˆ·å¹´é¾„ï¼Œä½“é‡ï¼Œè¿åŠ¨ç»å†ï¼Œå½“å‰è®­ç»ƒè®¡åˆ’å’Œç”¨æˆ·è‡ªå®šä¹‰çš„å¼ºåº¦æŒ‡æ•°ç­‰ã€‚å‡è®¾è¿™ä¸ªç®—æ³•éœ€è¦è¿è¡Œå‡ ç§’é’Ÿï¼Œæˆ‘ä»¬åªæƒ³åœ¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ç®—æ³•ä¸€æ¬¡ï¼Œå…å¾—è®©ç”¨æˆ·ä¸å¿…è¦çš„ç­‰å¾…ç»“æœã€‚</p> <p>å‡è®¾ç”¨å‡½æ•°<code>simulated_expensive_calculation</code>æ¨¡æ‹Ÿç®—æ³•è°ƒç”¨ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> std<span class="token punctuation">::</span>thread<span class="token punctuation">;</span>
<span class="token keyword">use</span> std<span class="token punctuation">::</span>time<span class="token punctuation">::</span>Duration<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">simulated_expensive_calculation</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œç®—æ³•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    intensity
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æ¥ä¸‹æ¥æ˜¯<code>main</code>å‡½æ•°ï¼ŒåŒ…å«äº†ç”¨æˆ·åœ¨è°ƒç”¨è®­ç»ƒè®¡åˆ’æ—¶è¦æ‰§è¡Œçš„ä»£ç ã€‚*é—­åŒ…ï¼ˆclosureï¼‰*çš„ä½¿ç”¨å’Œå‰ç«¯äº¤äº’æ²¡å•¥å…³ç³»ï¼Œå› æ­¤è¿™é‡Œç¡¬ç¼–ç å‚æ•°ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> simulated_user_specified_value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> simulated_random_number <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

    <span class="token function">generate_workout</span><span class="token punctuation">(</span>simulated_user_specified_value<span class="token punctuation">,</span> simulated_random_number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ¥ä¸‹æ¥æ¨¡æ‹Ÿä¸€ä¸‹ç”Ÿæˆè®­ç»ƒè®¡åˆ’çš„ç®—æ³•å‡½æ•°<code>generate_workout</code>ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">generate_workout</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> random_number<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> intensity <span class="token operator">&lt;</span> <span class="token number">25</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Today, do {} pushups!&quot;</span><span class="token punctuation">,</span>
            <span class="token function">simulated_expensive_calculation</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println!</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Next, do {} situps!&quot;</span><span class="token punctuation">,</span>
            <span class="token function">simulated_expensive_calculation</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> random_number <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Take a break today! Remember to stay hydrated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Today, run for {} minutes!&quot;</span><span class="token punctuation">,</span>
                <span class="token function">simulated_expensive_calculation</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>è¿™ä¸ªä»£ç å·²ç»å®ç°äº†ä¸šåŠ¡æ–¹çš„éœ€æ±‚ã€‚å‡è®¾å¤§æ•°æ®å›¢é˜Ÿæƒ³è¦æˆ‘ä»¬åœ¨ä»¥åä¿®æ”¹<code>simulated_expensive_calculation</code>çš„è°ƒç”¨æ–¹å¼ã€‚ä¸ºäº†ç®€åŒ–å‡çº§æµç¨‹ï¼Œéœ€è¦é‡æ„ä»£ç ï¼Œè®©<code>simulated_expensive_calculation</code>åªæ‰§è¡Œä¸€æ¬¡ã€‚å¹¶ä¸”å¤šæ¬¡è°ƒç”¨çš„åœ°æ–¹ä¹Ÿéœ€è¦åˆ é™¤æ‰ã€‚</p> <h3 id="refactoring-using-functions"><a href="#refactoring-using-functions" class="header-anchor">#</a> Refactoring Using Functions</h3> <p>é¦–å…ˆï¼Œå¯ä»¥å°†<code>simulated_expensive_calculation</code>å‡½æ•°çš„æ‰§è¡Œç»“æœå­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">generate_workout</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> random_number<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> expensive_result <span class="token operator">=</span> <span class="token function">simulated_expensive_calculation</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> intensity <span class="token operator">&lt;</span> <span class="token number">25</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Today, do {} pushups!&quot;</span><span class="token punctuation">,</span> expensive_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Next, do {} situps!&quot;</span><span class="token punctuation">,</span> expensive_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> random_number <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Take a break today! Remember to stay hydrated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Today, run for {} minutes!&quot;</span><span class="token punctuation">,</span> expensive_result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>è¿™ä¸ªè§£å†³æ–¹å¼ç»Ÿä¸€äº†<code>simulated_expensive_calculation</code>å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶ä¸”è§£å†³äº†<code>if</code>ä»£ç å—ä¸­å‡½æ•°ä¸å¿…è¦çš„å¤šæ¬¡è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆéœ€è¦æ‰€æœ‰æ¡ä»¶ä¸‹çš„æƒ…å†µç­‰å¾…ç®—æ³•æ‰§è¡Œç»“æœï¼Œå“ªæ€•æœ€ç»ˆæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªç»“æœã€‚</p> <p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³è®©ä»£ç åªåœ¨éœ€è¦ç»“æœçš„æ—¶å€™è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™ä¸ªåœºæ™¯å°±å¾ˆé€‚ç”¨äº<em>é—­åŒ…ï¼ˆclosureï¼‰</em>ã€‚</p> <h3 id="refactoring-with-closures-to-store-code"><a href="#refactoring-with-closures-to-store-code" class="header-anchor">#</a> Refactoring with Closures to Store Code</h3> <p>å®šä¹‰å’Œå‚¨å­˜é—­åŒ…ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> expensive_closure <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>num<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;calculating slowly...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    num
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é—­åŒ…å®šä¹‰è¢«èµ‹å€¼ç»™å˜é‡<code>expensive_closure</code>ã€‚é—­åŒ…å®šä¹‰åˆä¸¤ä¸ªç«–çº¿<code>|</code>å¼€å¤´ï¼Œç«–çº¿ä¸­é—´æ˜¯ä¼ ç»™é—­åŒ…çš„å‚æ•°ã€‚é€‰æ‹©è¿™ç§è¯­æ³•æ˜¯å› ä¸ºå®ƒè·ŸSmalltalkå’ŒRubyç›¸ä¼¼ã€‚è¿™ä¸ªé—­åŒ…æœ‰ä¸€ä¸ªå‚æ•°<code>num</code>ï¼Œå¦‚æœéœ€è¦ä¼ å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥<code>|p1, p2, ...|</code>ã€‚</p> <p>ç„¶åç”¨èŠ±æ‹¬å·åŒ…ä½é—­åŒ…ä½“ï¼Œå¯ä»¥çœ‹åˆ°å°±æ˜¯å‡½æ•°ä¸­çš„å†…å®¹ã€‚</p> <p>ç°åœ¨<code>let</code>è¯­å¥æ„å‘³ç€<code>expensive_closure</code>å˜é‡åŒ…å«ä¸€ä¸ªåŒ¿åå‡½æ•°çš„å®šä¹‰ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„è¿è¡Œç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨åé¢æ‰§è¡Œçš„ä»£ç å­˜å‚¨åœ¨è¿™ä¸ªå˜é‡ä¸­ã€‚</p> <p>æ¥ä¸‹æ¥ä¿®æ”¹<code>generate_workout</code>å‡½æ•°ä¸­ç®—æ³•è°ƒç”¨çš„éƒ¨åˆ†ã€‚é—­åŒ…è°ƒç”¨å’Œå‡½æ•°è°ƒç”¨ä¸€æ ·ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">generate_workout</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> random_number<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> expensive_closure <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>num<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;calculating slowly...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> intensity <span class="token operator">&lt;</span> <span class="token number">25</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Today, do {} pushups!&quot;</span><span class="token punctuation">,</span> <span class="token function">expensive_closure</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Next, do {} situps!&quot;</span><span class="token punctuation">,</span> <span class="token function">expensive_closure</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> random_number <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Take a break today! Remember to stay hydrated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Today, run for {} minutes!&quot;</span><span class="token punctuation">,</span>
                <span class="token function">expensive_closure</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ç°åœ¨ï¼Œåˆå¼•å…¥äº†å¤šæ¬¡è°ƒç”¨çš„é—®é¢˜ã€‚æ˜‚è´µçš„è®¡ç®—æ“ä½œä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œç”¨æˆ·ç­‰å¾…çš„æ—¶é•¿æ›´ä¹…ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å†…éƒ¨çš„<code>if</code>å—ä¸­åˆ›å»ºä¸€ä¸ªå˜é‡å­˜å‚¨è®¡ç®—ç»“æœã€‚ä½†æ˜¯é—­åŒ…æä¾›äº†æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ç¨åä¼šä»‹ç»è¯¥æ–¹æ¡ˆã€‚ç›®å‰å…ˆå¥—è·¯ä¸€ä¸‹ä¸ºä»€ä¹ˆé—­åŒ…å®šä¹‰æ²¡æœ‰ç±»å‹å£°æ˜ï¼Œä¹Ÿæ²¡æœ‰ç›¸å…³çš„traitã€‚</p> <h3 id="closure-type-inference-and-annotation"><a href="#closure-type-inference-and-annotation" class="header-anchor">#</a> Closure Type Inference and Annotation</h3> <p>é—­åŒ…ä¸ä¼šåƒå‡½æ•°ä¸€æ ·è¦æ±‚ä½ å£°æ˜å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚å‡½æ•°è¦æ±‚å£°æ˜ç±»å‹æ˜¯å› ä¸ºå®ƒæ˜¯æ˜¾å¼æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚ä¸¥æ ¼åœ°å®šä¹‰æ¥å£èƒ½å¤Ÿä¿è¯æ‰€æœ‰çš„è°ƒç”¨è€…éƒ½æŒ‰ç…§ä½ çš„é¢„æœŸæ¥ä¼ é€’å‚æ•°å’Œå¤„ç†è¿”å›å€¼ã€‚ä½†æ˜¯é—­åŒ…ä¸æ˜¯ç”¨äºå¯¹å¤–æ¥å£çš„ï¼Œå®ƒæ˜¯ç»™åº“å†…éƒ¨ç”¨çš„ã€‚</p> <p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºé—­åŒ…å£°æ˜ç±»å‹ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> expensive_closure <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>num<span class="token punctuation">:</span> u32<span class="token punctuation">|</span></span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;calculating slowly...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    num
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å¢åŠ äº†ç±»å‹å£°æ˜ä¹‹åï¼Œé—­åŒ…å®šä¹‰æ›´æ¥è¿‘å‡½æ•°å®šä¹‰äº†ã€‚ä¸‹é¢æ˜¯å‡½æ•°å£°æ˜è¯­æ³•å’Œé—­åŒ…çš„ä¸€ä¸ªå‚ç›´å¯¹æ¯”ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span>  <span class="token function">add_one_v1</span>   <span class="token punctuation">(</span>x<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> add_one_v2 <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>x<span class="token punctuation">:</span> u32<span class="token punctuation">|</span></span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> add_one_v3 <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>x<span class="token punctuation">|</span></span>             <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> add_one_v4 <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token operator">|</span>               x <span class="token operator">+</span> <span class="token number">1</span>  <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç¬¬äºŒè¡Œæ˜¯å®Œæ•´å£°æ˜å®šä¹‰ï¼Œè·Ÿå‡½æ•°ä¸€æ ·ã€‚ç¬¬ä¸‰è¡Œå»æ‰äº†ç±»å‹å£°æ˜ã€‚ç¬¬å››è¡Œå»æ‰äº†èŠ±æ‹¬å·ï¼Œå› ä¸ºé—­åŒ…å†…å®¹åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ­¤æ—¶å¯ä»¥å°†èŠ±æ‹¬å·ä¹Ÿçœç•¥ã€‚è¿™äº›å£°æ˜éƒ½æ˜¯æœ‰æ•ˆçš„è€Œä¸”åŠŸèƒ½éƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p> <p>é—­åŒ…å¯¹å‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰å…·ä½“çš„ç±»å‹æ¨æ–­ã€‚å½“æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç±»å‹æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨äº†ä¸¤æ¬¡é—­åŒ…ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶å€™çš„ç±»å‹ï¼Œä¼šè¢«ç¼–è¯‘å™¨é”å®šåœ¨é—­åŒ…ä¸­ï¼Œå¦‚æœåç»­è°ƒç”¨æˆ‘ä»¬ç”¨å…¶å®ƒç±»å‹çš„å‚æ•°ï¼Œç¼–è¯‘å™¨å°±æŠ¥é”™ã€‚</p> <h3 id="storing-closures-using-generic-parameters-and-the-fn-traits"><a href="#storing-closures-using-generic-parameters-and-the-fn-traits" class="header-anchor">#</a> Storing Closures Using Generic Parameters and the Fn Traits</h3> <p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œé—­åŒ…è¢«å¤šæ¬¡è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç»“æ„ä½“æ¥å­˜å‚¨é—­åŒ…å’Œé—­åŒ…çš„è¿è¡Œç»“æœã€‚åªæœ‰å½“ç»“æ„ä½“ä¸­è¿˜æ²¡æœ‰ç¼“å­˜ç»“æœå€¼æ—¶ï¼Œæ‰ä¼šè¿è¡Œé—­åŒ…ã€‚è¿™ç§æ¨¡å¼ç§°ä¸ºå¤‡å¿˜å½•æˆ–è€…æ‡’åŠ è½½ã€‚</p> <p>ç»“æ„ä½“å­˜å‚¨é—­åŒ…æ—¶ï¼Œé—­åŒ…å®šä¹‰éœ€è¦æ·»åŠ ç±»å‹å£°æ˜ã€‚å› ä¸ºç»“æ„ä½“å®šä¹‰ä¸­ï¼Œå­—æ®µç±»å‹æ˜¯å¿…é¡»çš„ã€‚æ¯ä¸ªé—­åŒ…ç¤ºä¾‹éƒ½æœ‰å”¯ä¸€çš„åŒ¿åç±»å‹ï¼Œè¿™æ„å‘³ç€ï¼Œå°±ç®—ä¸¤ä¸ªé—­åŒ…çš„ç±»å‹å®šä¹‰éƒ½ä¸€è‡´ï¼Œç¼–è¯‘å™¨è¿˜æ˜¯è®¤ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„ç±»å‹ã€‚åœ¨ç»“æ„ä½“ï¼Œæšä¸¾å’Œå‡½æ•°å‚æ•°ä¸­å®šä¹‰é—­åŒ…ï¼Œéœ€è¦ç”¨åˆ°æ³›å‹å’Œtraitç»‘å®šã€‚</p> <p><code>Fn</code>traitç”±æ ‡å‡†åº“æä¾›ã€‚æ‰€æœ‰é—­åŒ…è‡³å°‘éœ€è¦å®ç°<code>Fn</code>ï¼Œ<code>FnMut</code>ï¼Œ<code>FnOnce</code>traitä¹‹ä¸€ã€‚</p> <p>åœ¨<code>Fn</code>traitç»‘å®šä¸Šå£°æ˜ç±»å‹ï¼Œä»£è¡¨é—­åŒ…çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹å¿…é¡»å’Œè¯¥ç»‘å®šã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32<span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    calculation<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>Cacher</code>ç»“æ„ä½“æœ‰ä¸€ä¸ª<code>T</code>ç±»å‹çš„<code>calculation</code>å­—æ®µã€‚traitç»‘å®šåœ¨<code>T</code>ç±»å‹ä¸Šè¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯å®ç°äº†<code>Fn</code>traitçš„é—­åŒ…ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨è¿™ä¸ªå­—æ®µä¸Šå­˜å‚¨é—­åŒ…ï¼Œé‚£ä¹ˆè¿™ä¸ªé—­åŒ…å¿…é¡»ç¬¦åˆä¸€ä¸ª<code>u32</code>å‚æ•°å’Œä¸€ä¸ª<code>u32</code>è¿”å›å€¼çš„å£°æ˜ã€‚</p> <p><code>Value</code>å­—æ®µçš„ç±»å‹æ˜¯<code>Option&lt;u32&gt;</code>ï¼Œåˆå§‹å€¼æ˜¯<code>None</code>ã€‚å½“å…¶ä»–ä»£ç éœ€è¦<code>Cacher</code>ä¸­å­˜å‚¨çš„é—­åŒ…çš„è¿ç®—ç»“æœæ—¶ï¼Œ<code>Cacher</code>ä¼šè¿è¡Œå®ƒå­˜å‚¨çš„é—­åŒ…ï¼Œå¹¶ä¸”å°†ç»“æœè¿”å›å’Œç¼“å­˜ã€‚å½“å†æ¬¡è°ƒç”¨<code>Cacher</code>è·å–é—­åŒ…è¿ç®—ç»“æœæ—¶ï¼Œå°±å°†ä¹‹å‰çš„è®¡ç®—ç»“æœè¿”å›ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32<span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        Cacher <span class="token punctuation">{</span>
            calculation<span class="token punctuation">,</span>
            value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>
            <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">,</span>
            None <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                v
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>æˆ‘ä»¬å¸Œæœ›<code>Cacher</code>è‡ªèº«æ¥ç®¡ç†å­—æ®µå€¼ï¼Œè€Œä¸æ˜¯è®©å¤–éƒ¨ä»£ç å»ä¿®æ”¹ï¼Œå› æ­¤è¿™äº›å­—æ®µéƒ½æ˜¯ç§æœ‰çš„ï¼Œé€šè¿‡æ–¹æ³•è¿”å›ã€‚</p> <p>ç„¶åå†ä¿®æ”¹<code>generate_workout</code>å‡½æ•°ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">generate_workout</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> random_number<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> expensive_result <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>num<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;calculating slowly...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> intensity <span class="token operator">&lt;</span> <span class="token number">25</span> <span class="token punctuation">{</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Today, do {} pushups!&quot;</span><span class="token punctuation">,</span> expensive_result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Next, do {} situps!&quot;</span><span class="token punctuation">,</span> expensive_result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> random_number <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Take a break today! Remember to stay hydrated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">println!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Today, run for {} minutes!&quot;</span><span class="token punctuation">,</span>
                expensive_result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>intensity<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="limitations-of-the-cacher-implementation"><a href="#limitations-of-the-cacher-implementation" class="header-anchor">#</a> Limitations of the <code>Cacher</code> Implementation</h3> <p>ç›®å‰è¿™ä¸ª<code>Cacher</code>å®ç°è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚</p> <p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ— è®º<code>Cacher</code>å®ä¾‹æ¥æ”¶ä»€ä¹ˆå‚æ•°ï¼Œéƒ½è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°è®¡ç®—çš„ç»“æœã€‚æ¯”å¦‚ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ä¼šå¤±è´¥</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">call_with_different_values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> c <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>a<span class="token operator">|</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> v1 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v2 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å°†<code>value</code>å­—æ®µæ”¹ä¸ºå“ˆå¸Œè¡¨ç±»å‹ï¼Œé€šè¿‡å‚æ•°æ¥æ˜ å°„è®¡ç®—å€¼å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯è¿™ä¸ª<code>Cacher</code>åªèƒ½å­˜å‚¨<code>u32</code>å‚æ•°ç±»å‹å’Œ<code>u32</code>è¿”å›å€¼ç±»å‹çš„é—­åŒ…ã€‚ä½†æ˜¯æˆ‘ä»¬å¯èƒ½æƒ³å­˜å‚¨å…¶ä»–ç±»å‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªæ³›å‹ç±»å‹å‚æ•°ã€‚</p> <h3 id="capturing-the-environment-with-closures"><a href="#capturing-the-environment-with-closures" class="header-anchor">#</a> Capturing the Environment with Closures</h3> <p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠé—­åŒ…å½“ä½œåŒ¿åå‡½æ•°ä½¿ç”¨ã€‚é—­åŒ…è¿˜æœ‰ä¸€ä¸ªå‡½æ•°ä¸å…·å¤‡çš„åŠŸèƒ½ï¼šé—­åŒ…å¯ä»¥æ•è·å®ƒå®šä¹‰æ‰€åœ¨çš„ä¸Šä¸‹æ–‡å¹¶ä¸”å¯ä»¥è®¿é—®å˜é‡ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> equal_to_x <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equal_to_x</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>x</code>å˜é‡ä¸æ˜¯é—­åŒ…çš„å‚æ•°ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥è¢«é—­åŒ…è®¿é—®ã€‚å› ä¸º<code>x</code>å˜é‡å’Œé—­åŒ…æ˜¯å®šä¹‰åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„ã€‚</p> <p>å½“é—­åŒ…æ•è·ä¸Šä¸‹æ–‡çš„å˜é‡æ—¶ï¼Œä¼šå°†è¿™äº›å˜é‡å­˜å‚¨åˆ°å†…å­˜ä¸­ä½¿ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ä»£ç æ‰§è¡Œä¸éœ€è¦æ•è·ä¸Šä¸‹æ–‡å˜é‡ï¼Œè¿™ç§å†…å­˜å¼€é”€æ˜¯ä¸å¿…è¦çš„ã€‚å› ä¸ºå‡½æ•°ä¸å…è®¸æ•è·å®ƒçš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æ‰§è¡Œå‡½æ•°ä¸ä¼šå¼•èµ·è¿™äº›é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p> <p>é—­åŒ…å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼æ•è·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè·Ÿå‡½æ•°è·å–å‚æ•°çš„ä¸‰ç§æ–¹å¼å¯¹åº”ï¼šè·å–æ‰€æœ‰æƒã€å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨ã€‚è¿™ä¸‰ç§æ–¹å¼åˆ†åˆ«å°è£…åœ¨ä¸‰ç§<code>Fn</code>traitä¸­ã€‚</p> <ul><li><code>FnOnce</code>æ¶ˆè´¹æ•è·çš„å˜é‡æ—¶ï¼Œå¿…é¡»è·å–ä¸Šä¸‹æ–‡å˜é‡çš„æ‰€æœ‰æƒå¹¶ä¸”ä¼ é€’åˆ°é—­åŒ…ä¸­ã€‚Onceè¡¨ç¤ºé—­åŒ…ä¸èƒ½å¯¹åŒä¸€ä¸ªå˜é‡è·å–ä¸¤æ¬¡åŠä»¥ä¸Šæ‰€æœ‰æƒã€‚</li> <li><code>FnMut</code>èƒ½å¤Ÿæ”¹å˜èƒ½å¤Ÿæ”¹å˜ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å€¼ã€‚</li> <li><code>Fn</code>ä¸å¯ä»¥æ”¹å˜ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å€¼ã€‚</li></ul> <p>åˆ›å»ºé—­åŒ…æ—¶ï¼ŒRustä¼šæ ¹æ®ä½ ä½¿ç”¨å˜é‡çš„æ–¹å¼æ¥æ¨æ–­ä½ ä½¿ç”¨çš„æ˜¯å“ªä¸ªtraitã€‚æ‰€æœ‰é—­åŒ…éƒ½å®ç°<code>FnOnce</code>å› ä¸ºè‡³å°‘å¯ä»¥è¢«è°ƒç”¨ä¸€æ¬¡ã€‚ä¸è·å–æ‰€æœ‰æƒçš„é—­åŒ…å®ç°<code>FnMut</code>traitã€‚ä¸æ”¹å˜å¤–éƒ¨å˜é‡çš„é—­åŒ…å®ç°<code>Fn</code>traitã€‚</p> <p>å¦‚æœæƒ³è¦é—­åŒ…å¼ºåˆ¶è·å–æ‰€æœ‰æƒï¼Œå¯ä»¥åœ¨å‚æ•°åˆ—è¡¨å‰ä½¿ç”¨<code>move</code>å…³é”®å­—ã€‚å½“æŠŠé—­åŒ…ä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œè®©æ–°çº¿ç¨‹è·å–æ‰€æœ‰æƒæ—¶ï¼Œè¿™ç§æ–¹æ³•å¾ˆæœ‰ç”¨ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¼ºåˆ¶ä¼ é€’vecæ•°æ®æ‰€æœ‰æƒçš„ä¾‹å­ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> equal_to_x <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;can't use x here: {:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equal_to_x</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>x</code>çš„æ‰€æœ‰æƒè¢«ä¼ é€’ç»™äº†é—­åŒ…ï¼Œåœ¨<code>println!</code>ä¸­ä½¿ç”¨ä¼šæŠ¥é”™ã€‚</p> <h2 id="section-2-processing-a-series-of-items-with-iterators"><a href="#section-2-processing-a-series-of-items-with-iterators" class="header-anchor">#</a> Section 2 - Processing a Series of Items with Iterators</h2> <p>è¿­ä»£å™¨æ¨¡å¼å¯ä»¥è®©ä½ åœ¨ä¸€ä¸ªæœ‰åºåˆ—è¡¨ä¸Šä¾æ¬¡æ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚è¿­ä»£å™¨ä¸»è¦è´Ÿè´£åºåˆ—ä¸­æ¯ä¸ªé¡¹ç›®è¦æ‰§è¡Œçš„æ“ä½œå’Œæ§åˆ¶åºåˆ—çš„é€€å‡ºã€‚</p> <p>Rustä¸­è¿­ä»£å™¨æ˜¯æƒ°æ€§çš„ã€‚æ„å‘³ç€åªè¦ä½ ä¸è°ƒç”¨æ¶ˆè´¹è¿­ä»£å™¨çš„æ–¹æ³•ï¼Œå®ƒå°±ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚æ¯”å¦‚è¿™ä¸ªä»£ç å°±æ²¡æœ‰ä»»ä½•å®é™…ä½œç”¨ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> v1_iter <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å½“æˆ‘ä»¬åˆ›å»ºè¿­ä»£å™¨åï¼Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å»æ¶ˆè´¹å®ƒã€‚</p> <p>é€šè¿‡<code>for</code>å¾ªç¯ï¼Œåœ¨æ¯ä¸ªå…ƒç´ ä¸Šæ‰§è¡Œä¸€äº›æ“ä½œã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> v1_iter <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> val <span class="token keyword">in</span> v1_iter <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Got: {}&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¿­ä»£å™¨å¯ä»¥è®©ä½ æ›´çµæ´»çš„åœ¨ä¸åŒåºåˆ—ä¸Šä½¿ç”¨ç›¸åŒçš„é€»è¾‘ï¼Œä¸å…‰æ˜¯åœ¨æ•°ç»„è¿™æ ·çš„æ•°æ®ç»“æ„ä¸Šã€‚</p> <h3 id="iteratortraitå’Œnext-æ–¹æ³•"><a href="#iteratortraitå’Œnext-æ–¹æ³•" class="header-anchor">#</a> <code>Iterator</code>Traitå’Œ<code>next</code> æ–¹æ³•</h3> <p>æ‰€æœ‰çš„è¿­ä»£å™¨éƒ½å®ç°äº†æ ‡å‡†åº“æä¾›çš„<code>Iterator</code>traitã€‚å®ƒçš„å®šä¹‰å¤§è‡´æ˜¯ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Iterator <span class="token punctuation">{</span>
    <span class="token keyword">type</span> Item<span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Option<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>Item<span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token comment">// methods with default implementations elided</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æœ‰ä¸¤ä¸ªæ–°è¯­æ³•<code>type Item</code>å’Œ<code>Self::Item</code>ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªtraitçš„å…³è”ç±»å‹ã€‚å› æ­¤ï¼Œå®ç°<code>Iterator</code>traitéœ€è¦ä½ å®šä¹‰ä¸€ä¸ª<code>Item</code>ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¼šåœ¨<code>next</code>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä¸­ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Item</code>ç±»å‹æ˜¯è¿­ä»£å™¨çš„è¿”å›ç±»å‹ã€‚</p> <p><code>Iterator</code>traitåªæœ‰<code>next</code>æ–¹æ³•æ˜¯å¿…é¡»å®ç°çš„ï¼Œè¿™ä¸ªæ–¹æ³•ä¸€æ¬¡è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œç”¨<code>Some</code>åŒ…è£¹ï¼›å½“è¿­ä»£ç»“æŸæ—¶ï¼Œè¿”å›<code>None</code>ã€‚</p> <p>å¯ä»¥ç›´æ¥é€šè¿‡è¿­ä»£å™¨è°ƒç”¨<code>next</code>æ–¹æ³•ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">iterator_demonstration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> v1_iter <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1_iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1_iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1_iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1_iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä½¿ç”¨<code>next</code>æ–¹æ³•æ—¶ï¼Œè¿­ä»£å™¨éœ€è¦<code>mut</code>å…³é”®å­—å®šä¹‰ã€‚nextæ–¹æ³•ä¼šæ”¹å˜è¿­ä»£å™¨ä¸­ç”¨æ¥è¿½è¸ªç›®å‰æ‰€è¿­ä»£çš„ä½ç½®çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥è¯´è¿™æ˜¯ä¸€ç§*æ¶ˆè´¹ï¼ˆconsumesï¼‰*è¡Œä¸ºã€‚åœ¨<code>for</code>å¾ªç¯ä¸­ï¼Œè¿­ä»£å™¨å®šä¹‰ä¸éœ€è¦<code>mut</code>å…³é”®å­—ï¼Œå› ä¸º<code>for</code>å¾ªç¯ä¼šè·å–è¿­ä»£å™¨çš„æ‰€æœ‰æƒï¼Œéšå¼åœ°å°†å…¶è½¬ä¸ºmutableçš„ã€‚</p> <p><code>next</code>æ–¹æ³•è¿”å›çš„æ•°æ®æ˜¯åŸåºåˆ—ä¸­å…ƒç´ çš„ä¸å¯å˜å¼•ç”¨ã€‚<code>iter</code>åœ¨ä¸å¯å˜å¼•ç”¨ä¸Šç”Ÿæˆè¿­ä»£å™¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰åŸåºåˆ—æ‰€æœ‰æƒçš„è¿­ä»£å™¨ï¼Œå¯ä»¥è°ƒç”¨<code>into_iter</code>ã€‚å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨çš„å¯å˜å¼•ç”¨ï¼Œå¯ä»¥è°ƒç”¨<code>iter_mut</code>ã€‚</p> <h3 id="æ¶ˆè´¹è¿­ä»£å™¨çš„æ–¹æ³•"><a href="#æ¶ˆè´¹è¿­ä»£å™¨çš„æ–¹æ³•" class="header-anchor">#</a> æ¶ˆè´¹è¿­ä»£å™¨çš„æ–¹æ³•</h3> <p>æ ‡å‡†åº“é»˜è®¤ä¸º<code>Iterator</code>traitæä¾›äº†è®¸å¤šæ–¹æ³•ã€‚æœ‰äº›æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨<code>next</code>æ–¹æ³•ï¼Œå› æ­¤åœ¨å®ç°<code>Iterator</code>traitæ—¶ï¼Œå¿…é¡»å®ç°<code>next</code>æ–¹æ³•ã€‚</p> <p>è°ƒç”¨<code>next</code>æ–¹æ³•çš„é‚£äº›æ–¹æ³•ç§°ä¸º<em>æ¶ˆè´¹å‹é€‚é…å™¨ï¼ˆconsuming adaptorsï¼‰</em>ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ¶ˆè€—è¿­ä»£å™¨ã€‚ä¾‹å¦‚<code>sum</code>æ–¹æ³•ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">iterator_sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> v1_iter <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> total<span class="token punctuation">:</span> i32 <span class="token operator">=</span> v1_iter<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="äº§ç”Ÿæ–°è¿­ä»£å™¨çš„æ–¹æ³•"><a href="#äº§ç”Ÿæ–°è¿­ä»£å™¨çš„æ–¹æ³•" class="header-anchor">#</a> äº§ç”Ÿæ–°è¿­ä»£å™¨çš„æ–¹æ³•</h3> <p>è¿˜æœ‰ä¸€äº›<code>Iterator</code>traitä¸Šå®šä¹‰æ–¹æ³•ï¼Œç§°ä¹‹ä¸º<em>è¿­ä»£å™¨é€‚é…å™¨ï¼ˆiterator adaptorsï¼‰</em>ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æŠŠè¿­ä»£å™¨è½¬æ¢æˆå…¶ä»–ç±»å‹çš„è¿­ä»£å™¨ã€‚è¿­ä»£å™¨é€‚é…å™¨å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥æé«˜ä¸€ç»„å¤æ‚æ“ä½œçš„å¯è¯»æ€§ã€‚ç”±äºè¿­ä»£å™¨æ˜¯æƒ°æ€§çš„ï¼Œå› æ­¤ä½ æœ€ç»ˆéœ€è¦è°ƒç”¨æ¶ˆè´¹é€‚é…å™¨ï¼Œè¿™ä¸€ç»„æ“ä½œæ‰ä¼šçœŸæ­£èµ·ä½œç”¨ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> v1<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢çš„ä»£ç ç¼–è¯‘å™¨ä¼šç»™å‡ºä¸€ä¸ªè­¦å‘Šï¼š<code>iterators are lazy and do nothing unless consumed</code>ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªä»£ç ä¸ä¼šèµ·ä»»ä½•ä½œç”¨ï¼Œå®šä¹‰çš„é—­åŒ…ä¹Ÿæ ¹æœ¬æ²¡æœ‰è¢«æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨æ¶ˆè´¹é€‚é…å™¨ï¼Œæ¯”å¦‚<code>collect</code>æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> v1<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> v2<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>_<span class="token operator">&gt;</span> <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="ä½¿ç”¨é—­åŒ…æ•è·ä¸Šä¸‹æ–‡"><a href="#ä½¿ç”¨é—­åŒ…æ•è·ä¸Šä¸‹æ–‡" class="header-anchor">#</a> ä½¿ç”¨é—­åŒ…æ•è·ä¸Šä¸‹æ–‡</h3> <p>ä¸‹é¢é€šè¿‡ä½¿ç”¨<code>filter</code>è¿­ä»£é€‚é…å™¨æ¥æ¼”ç¤ºä¸€ä¸ªé—­åŒ…æ•è·ä¸Šä¸‹æ–‡çš„åŸºæœ¬ç”¨æ³•ã€‚<code>filter</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œè¿™ä¸ªé—­åŒ…çš„å‚æ•°æ˜¯è¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœé—­åŒ…è¿”å›<code>true</code>ï¼Œåˆ™è¯¥å…ƒç´ ä¼šè¢«åŒ…å«åœ¨<code>filter</code>æ–¹æ³•è¿”å›çš„è¿­ä»£å™¨ä¸­ï¼Œåä¹‹äº¦ç„¶ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(PartialEq, Debug)]</span>
<span class="token keyword">struct</span> Shoe <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">shoes_in_my_size</span><span class="token punctuation">(</span>shoes<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>Shoe<span class="token operator">&gt;</span><span class="token punctuation">,</span> shoe_size<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Vec<span class="token operator">&lt;</span>Shoe<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    shoes<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token operator">|</span>s<span class="token operator">|</span> s<span class="token punctuation">.</span>size <span class="token operator">==</span> shoe_size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">filters_by_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> shoes <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>
            Shoe <span class="token punctuation">{</span>
                size<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                style<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sneaker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Shoe <span class="token punctuation">{</span>
                size<span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
                style<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sandal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Shoe <span class="token punctuation">{</span>
                size<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                style<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;boot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> in_my_size <span class="token operator">=</span> <span class="token function">shoes_in_my_size</span><span class="token punctuation">(</span>shoes<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>
            in_my_size<span class="token punctuation">,</span>
            <span class="token function">vec!</span><span class="token punctuation">[</span>
                Shoe <span class="token punctuation">{</span>
                    size<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sneaker&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                Shoe <span class="token punctuation">{</span>
                    size<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;boot&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h3 id="ä½¿ç”¨iteratortraitå®ç°è‡ªå®šä¹‰è¿­ä»£å™¨"><a href="#ä½¿ç”¨iteratortraitå®ç°è‡ªå®šä¹‰è¿­ä»£å™¨" class="header-anchor">#</a> ä½¿ç”¨<code>Iterator</code>traitå®ç°è‡ªå®šä¹‰è¿­ä»£å™¨</h3> <p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨Vecç±»å‹ä¸Šçš„<code>iter</code>ï¼Œ<code>iter_mut</code>ï¼Œ<code>into_iter</code>æ¥ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ã€‚ä½ ä¹Ÿå¯ä»¥ä¸ºæ ‡å‡†åº“ä¸­çš„å…¶ä»–ç±»å‹æ¥åˆ›å»ºè¿­ä»£å™¨ï¼Œä¾‹å¦‚å“ˆå¸Œè¡¨ã€‚ä¹Ÿå¯ä»¥åœ¨ä½ è‡ªå·±çš„ç±»å‹ä¸Šï¼Œå®ç°<code>Iterator</code>traitï¼Œä»è€Œå®ç°ä»»ä½•ä½ æƒ³è¦çš„åŠŸèƒ½ã€‚å”¯ä¸€å¿…é¡»è¦è¢«å®ç°çš„æ–¹æ³•æ˜¯<code>next</code>æ–¹æ³•ï¼Œå½“ä½ å®ç°<code>next</code>æ–¹æ³•åï¼Œå°±å¯ä»¥è°ƒç”¨å…¶ä»–<code>Iterator</code>traitå®ç°çš„é»˜è®¤æ–¹æ³•ã€‚</p> <p>å®ç°ä¸€ä¸ªä»1ç´¯åŠ åˆ°5çš„è¿­ä»£å™¨æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Counter <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Counter <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Counter <span class="token punctuation">{</span>
        Counter <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Iterator <span class="token keyword">for</span> Counter <span class="token punctuation">{</span>
    <span class="token keyword">type</span> Item <span class="token operator">=</span> u32<span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Option<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>count <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">Some</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            None
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">calling_next_directly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> Counter<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="ä½¿ç”¨iteratortraitçš„å…¶ä»–æ–¹æ³•"><a href="#ä½¿ç”¨iteratortraitçš„å…¶ä»–æ–¹æ³•" class="header-anchor">#</a> ä½¿ç”¨<code>Iterator</code>traitçš„å…¶ä»–æ–¹æ³•</h4> <p>æˆ‘ä»¬å®ç°<code>Iterator</code>traitï¼Œä¹Ÿå®šä¹‰äº†<code>next</code>æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è°ƒç”¨<code>Iterator</code>traitä¸Šï¼Œç”±æ ‡å‡†åº“é»˜è®¤å®ç°çš„ä»»æ„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨çš„éƒ½æ˜¯<code>next</code>æ–¹æ³•çš„åŠŸèƒ½ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">using_other_iterator_trait_methods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum<span class="token punctuation">:</span> u32 <span class="token operator">=</span> Counter<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>Counter<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token operator">|</span> a <span class="token operator">*</span> b<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢çš„ä»£ç å°†ä¸¤ä¸ªCounterè¿­ä»£å™¨ç»„åˆä¸ºå…ƒç»„æ•°ç»„ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªCounterçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«è·³è¿‡ï¼Œå› æ­¤æœ€åä¸€ç»„å…ƒç»„æ˜¯<code>(5, None)</code>ã€‚<code>zip</code>æ–¹æ³•ä¸ä¼šè¿”å›å…ƒç»„ä¸­å¸¦æœ‰<code>None</code>çš„å…ƒç´ ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f46cf57.js" defer></script><script src="/assets/js/2.49ce1412.js" defer></script><script src="/assets/js/15.41e8c95f.js" defer></script>
  </body>
</html>
