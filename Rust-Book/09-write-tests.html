<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 9 - Writing Automated Tests | KSLEO</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.35aebc44.css" as="style"><link rel="preload" href="/assets/js/app.6f46cf57.js" as="script"><link rel="preload" href="/assets/js/2.49ce1412.js" as="script"><link rel="preload" href="/assets/js/14.e42e08a4.js" as="script"><link rel="prefetch" href="/assets/js/10.86ad4e85.js"><link rel="prefetch" href="/assets/js/11.e7ef91a0.js"><link rel="prefetch" href="/assets/js/12.14d347b9.js"><link rel="prefetch" href="/assets/js/13.beaf8085.js"><link rel="prefetch" href="/assets/js/15.41e8c95f.js"><link rel="prefetch" href="/assets/js/16.e8b84c5d.js"><link rel="prefetch" href="/assets/js/17.4d574f20.js"><link rel="prefetch" href="/assets/js/18.a8a8e164.js"><link rel="prefetch" href="/assets/js/19.118b3a66.js"><link rel="prefetch" href="/assets/js/20.ccdc0717.js"><link rel="prefetch" href="/assets/js/21.88ceead5.js"><link rel="prefetch" href="/assets/js/22.500d3be7.js"><link rel="prefetch" href="/assets/js/23.b7ca339b.js"><link rel="prefetch" href="/assets/js/24.0360313a.js"><link rel="prefetch" href="/assets/js/25.6083b636.js"><link rel="prefetch" href="/assets/js/26.1bd9d3eb.js"><link rel="prefetch" href="/assets/js/27.beb716dd.js"><link rel="prefetch" href="/assets/js/28.bb093ca6.js"><link rel="prefetch" href="/assets/js/29.5b527549.js"><link rel="prefetch" href="/assets/js/3.8a6c11df.js"><link rel="prefetch" href="/assets/js/30.796276de.js"><link rel="prefetch" href="/assets/js/31.666b101e.js"><link rel="prefetch" href="/assets/js/32.654129d9.js"><link rel="prefetch" href="/assets/js/33.e479db51.js"><link rel="prefetch" href="/assets/js/4.e2a8d64a.js"><link rel="prefetch" href="/assets/js/5.dd4c966a.js"><link rel="prefetch" href="/assets/js/6.00a6c78e.js"><link rel="prefetch" href="/assets/js/7.9330d48e.js"><link rel="prefetch" href="/assets/js/8.560dd961.js"><link rel="prefetch" href="/assets/js/9.da6c1180.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35aebc44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KSLEO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/directory/" class="nav-link">
  ç¬”è®°ğŸ“’
</a></div><div class="nav-item"><a href="http://leokang28.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢ğŸ”—
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-9-writing-automated-tests"><a href="#chapter-9-writing-automated-tests" class="header-anchor">#</a> Chapter 9 - Writing Automated Tests</h1> <p>ç¨‹åºçš„æ­£ç¡®æ€§æ˜¯å®ƒæŒ‰æˆ‘ä»¬çš„é¢„æœŸè¿è¡Œçš„ç¨‹åº¦ã€‚Rustè¢«è®¾è®¡ä¸ºé«˜åº¦å…³æ³¨ç¨‹åºæ­£ç¡®æ€§çš„è¯­è¨€ï¼Œä½†æ­£ç¡®æ€§å¾ˆå¤æ‚è€Œä¸”ä¸å®¹æ˜“å®ç°ã€‚Rustçš„ç±»å‹ç³»ç»Ÿæ‰¿æ‹…äº†å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œä½†æ˜¯ç±»å‹ç³»ç»Ÿä¸èƒ½å¤Ÿæ•è·æ‰€æœ‰å¯èƒ½çš„é”™è¯¯ã€‚å› æ­¤ï¼ŒRustæ”¯æŒç¼–å†™è‡ªåŠ¨æµ‹è¯•ç”¨ä¾‹ã€‚</p> <h2 id="section-1-å¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><a href="#section-1-å¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹" class="header-anchor">#</a> Section - 1 å¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹</h2> <p>æµ‹è¯•ç”¨ä¾‹æ˜¯ç”¨æ¥éªŒè¯ä»£ç æ˜¯å¦æŒ‰é¢„æœŸè®¾è®¡è¿è¡Œçš„å‡½æ•°ã€‚æµ‹è¯•ç”¨ä¾‹é€šå¸¸åŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p> <ol><li>åˆå§‹åŒ–éœ€è¦çš„æ•°æ®å’ŒçŠ¶æ€ã€‚</li> <li>è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç ã€‚</li> <li>æ–­è¨€ç»“æœæ˜¯å¦æ­£ç¡®ã€‚</li></ol> <p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹Rustä¸ºç¼–å†™æµ‹è¯•ç”¨ä¾‹ç‰¹åˆ«æä¾›çš„åŠŸèƒ½ã€‚åŒ…æ‹¬<code>test</code>å±æ€§ï¼Œä¸€äº›å®å’Œ<code>should_panic</code>å±æ€§ã€‚</p> <h3 id="the-anatomy-of-a-test-function"><a href="#the-anatomy-of-a-test-function" class="header-anchor">#</a> The Anatomy of a Test Function</h3> <p>æœ€ç®€å•çš„æƒ…å†µï¼ŒRustä¸­ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å°±æ˜¯ä¸€ä¸ªå¸¦<code>test</code>å±æ€§çš„å‡½æ•°ã€‚å±æ€§æ˜¯å…³äºä»£ç ç‰‡æ®µçš„å…ƒæ•°æ®ã€‚åœ¨å‡½æ•°å®šä¹‰å‰åŠ ä¸€è¡Œ<code>#[test]</code>ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æµ‹è¯•ç”¨ä¾‹å‡½æ•°ã€‚ç„¶åå½“ä½ æ‰§è¡Œ<code>cargo test</code>ï¼ŒRuståˆ›å»ºä¸€ä¸ªç”¨æ¥æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè°ƒç”¨è¢«<code>test</code>å±æ€§æ ‡è®°çš„å‡½æ•°ï¼Œå¹¶ä¸”æŠ¥å‘Šè¿™äº›æµ‹è¯•çš„ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</p> <p>å½“æˆ‘ä»¬ä½¿ç”¨<code>Cargo</code>åˆ›å»ºåº“é¡¹ç›®æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæµ‹è¯•æ¨¡å—ï¼Œä½ å¯ä»¥è‡ªå·±æ·»åŠ å…¶ä»–çš„æµ‹è¯•æ¨¡å—å’Œå‡½æ•°ã€‚</p> <p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåº“é¡¹ç›®ã€‚<code>cargo new adder --lib</code>ã€‚ç„¶åå¯ä»¥çœ‹åˆ°é»˜è®¤åˆ›å»ºå¥½çš„æµ‹è¯•æ¨¡å—å’Œç”¨ä¾‹ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å…ˆæŠŠæ³¨æ„åŠ›é›†ä¸­åˆ°æµ‹è¯•ç”¨ä¾‹ä¸Šã€‚å‡½æ•°ä¸Šé¢ä¸€è¡Œçš„<code>#[test]</code>è¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œtest runnerä¼šåœ¨æµ‹è¯•çš„æ—¶å€™æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚æµ‹è¯•æ¨¡å—ä¸­ä¹Ÿå¯ä»¥åŒ…å«æ™®é€šçš„å‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–æˆ–è€…æä¾›æ™®é€šçš„æ“ä½œã€‚å› æ­¤éœ€è¦åœ¨æµ‹è¯•ç”¨ä¾‹å‰ç”¨å±æ€§æŒ‡æ˜ã€‚</p> <p>å‡½æ•°ä½“ä¸­ä½¿ç”¨åˆ°äº†<code>assert_eq!</code>å®ã€‚è¿™ä¸ªæ–­è¨€æ˜¯ä¸€ä¸ªå…¸å‹çš„æµ‹è¯•ç”¨ä¾‹ã€‚è¿è¡Œ<code>cargo test</code>ä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡ºä¿¡æ¯ã€‚</p> <div class="language- extra-class"><pre><code>$ cargo test
Compiling adder v0.1.0 (/Users/ksleo/private/rust_learn/adder)
 Finished test [unoptimized + debuginfo] target(s) in 0.57s
  Running target/debug/deps/adder-92948b65e88960b4

running 1 test
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><p>å¯ä»¥çœ‹åˆ°åœ¨<code>running 1 test</code>è¿™ä¸€è¡Œä¸‹é¢ï¼Œæ˜¾ç¤ºè¿è¡Œäº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹<code>it_works</code>ï¼Œå¹¶ä¸”è¿è¡Œç»“æœæ˜¯<code>ok</code>ã€‚æµ‹è¯•ç”¨ä¾‹çš„è¿è¡Œç»“æœæ±‡æ€»ç»Ÿè®¡åœ¨ä¸‹é¢ä¸€è¡Œã€‚<code>test result: ok</code>è¡¨ç¤ºæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡äº†æµ‹è¯•ï¼Œå¹¶ä¸”åé¢<code>1 passed; 0 failed;</code>ç»Ÿè®¡äº†æˆåŠŸå’Œå¤±è´¥çš„æ•°é‡ã€‚</p> <p>æµ‹è¯•è¾“å‡ºçš„ä¸‹ä¸€ä¸ªéƒ¨åˆ†æ˜¯<code>Doc-tests</code>ï¼Œè¿™ä¸ªæ˜¯æ–‡æ¡£æµ‹è¯•çš„ç»“æœã€‚æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æ–‡æ¡£æµ‹è¯•ï¼ŒRustèƒ½åœ¨APIæ–‡æ¡£é‡Œç”Ÿæˆç¤ºä¾‹ä»£ç ã€‚è¿™ä¸ªåŠŸèƒ½è®©ä»£ç å’Œæ–‡æ¡£ä¿æŒåŒæ­¥ã€‚</p> <p>å†æ·»åŠ ä¸€ä¸ªå¤±è´¥ç»“æœçš„æµ‹è¯•ç”¨ä¾‹ã€‚æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½è·‘åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹å¦‚æœå‘ç°æœ‰ä¸€ä¸ªæµ‹è¯•çº¿ç¨‹å¤±è´¥ï¼Œå°±æŠŠæµ‹è¯•ç»“æœæ ‡è®°ä¸ºå¤±è´¥ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">exploration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">another</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;Make this test fail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å†è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºã€‚</p> <div class="language- extra-class"><pre><code>running 2 tests
test tests::it_works ... ok
test tests::another ... FAILED

failures:

---- tests::another stdout ----
thread 'tests::another' panicked at 'Make this test fail', src/lib.rs:10:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::another

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out

error: test failed, to rerun pass '--lib'
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸¤å—<code>failures</code>å†…å®¹æ˜¯ä¹‹å‰æ²¡æœ‰çš„ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯å¤±è´¥ç”¨ä¾‹çš„æ–‡ä»¶è·¯å¾„å’Œäº§ç”Ÿé”™è¯¯çš„ä»£ç ä½ç½®ã€‚ç¬¬äºŒå—æ˜¯å¤±è´¥çš„ç”¨ä¾‹ååˆ—è¡¨ï¼Œå½“å¤±è´¥çš„ç”¨ä¾‹éå¸¸å¤šæ—¶ï¼Œè¿™ä¸ªåˆ—è¡¨å°±å¾ˆæœ‰ç”¨äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å•ç‹¬è¿è¡ŒæŸä¸ªç”¨ä¾‹è·å–æ›´å¤šçš„é”™è¯¯ä¿¡æ¯ã€‚</p> <p>ä¸‹é¢çš„æ‘˜è¦è¡Œæ˜¾ç¤ºï¼Œæµ‹è¯•ç»“æœæ˜¯<code>FAILED</code>ã€‚</p> <h3 id="ç”¨assert-å®æ–­è¨€ç»“æœ"><a href="#ç”¨assert-å®æ–­è¨€ç»“æœ" class="header-anchor">#</a> ç”¨<code>assert!</code>å®æ–­è¨€ç»“æœ</h3> <p><code>assert!</code>å®æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„ï¼Œç”¨äºåœ¨æµ‹è¯•ä¸­ç¡®å®šè¿è¡Œç»“æœæ˜¯å¦ä¸ºçœŸã€‚<code>assert!</code>ä¸€ä¸ªè¿”å›å¸ƒå°”å€¼çš„è¡¨è¾¾å¼ã€‚å¦‚æœè¿”å›å€¼æ˜¯<code>true</code>ï¼Œå®ƒä¸ä¼šåšä»»ä½•ç‰¹æ®Šå¤„ç†ï¼Œå¹¶ä¸”è¯¥æµ‹è¯•ç”¨ä¾‹ç»“æœä¸º<code>ok</code>ã€‚å¦‚æœä¸º<code>false</code>ï¼Œå®ƒä¼šè°ƒç”¨<code>panic!</code>å®æ¥è®©æµ‹è¯•ç”¨ä¾‹å¤±è´¥ã€‚ä½¿ç”¨<code>assert!</code>æ–­è¨€æ¥æ£€æµ‹å‡½æ•°æ˜¯å¦æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸè®¾è®¡æ‰§è¡Œã€‚</p> <p>ä¸‹é¢å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹ï¼Œç”¨æ¥æµ‹è¯•ä¹‹å‰ç« èŠ‚ä¸­å®šä¹‰çš„<code>Rectangle</code>ç»“æ„ä½“ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Rectangle<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> bool <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">larger_can_hold_smaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> larger <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> smaller <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">assert!</span><span class="token punctuation">(</span>larger<span class="token punctuation">.</span><span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smaller<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">smaller_cannot_hold_larger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> larger <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> smaller <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>smaller<span class="token punctuation">.</span><span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>larger<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>æ³¨æ„åœ¨æµ‹è¯•æ¨¡å—ä¸­å¼•å…¥äº†å¾…æµ‹è¯•æ¨¡å—çš„å‘½åç©ºé—´ã€‚æµ‹è¯•æ¨¡å—è·Ÿæ™®é€šæ¨¡å—ä¸€æ ·ï¼Œä¹Ÿè¦éµå¾ªå‘½åç©ºé—´è§„åˆ™ã€‚</p> <h3 id="ä½¿ç”¨assert-eq-å’Œassert-ne-æ–­è¨€ç›¸ç­‰æ€§"><a href="#ä½¿ç”¨assert-eq-å’Œassert-ne-æ–­è¨€ç›¸ç­‰æ€§" class="header-anchor">#</a> ä½¿ç”¨<code>assert_eq!</code>å’Œ<code>assert_ne!</code>æ–­è¨€ç›¸ç­‰æ€§</h3> <p>åˆ¤æ–­ç›¸ç­‰æ€§å¯ä»¥åœ¨<code>assert!</code>å®ä¸­ä¼ å…¥ä¸€ä¸ª<code>==</code>è¡¨è¾¾å¼ã€‚ä½†æ˜¯ç”±äºè¿™ç§åˆ¤æ–­æ˜¯ä¸€ä¸ªå¸¸ç”¨åœºæ™¯ï¼Œå› æ­¤æ ‡å‡†åº“æä¾›äº†ä¸“é—¨ç”¨æ¥åˆ¤æ–­ç›¸ç­‰æ€§çš„å®ã€‚è¿™ä¸¤ä¸ªå®æ¥æ”¶ä¸¤ä¸ªå‚æ•°æ¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦ç›¸ç­‰ã€‚æ–­è¨€å¤±è´¥æ—¶å®ƒä»¬ä¼šæ‰“å°å‡ºå‚æ•°å€¼ï¼Œå¯ä»¥æ›´æ¸…æ¥šçš„çŸ¥é“æµ‹è¯•ç”¨ä¾‹ä¸ºä»€ä¹ˆå¤±è´¥ã€‚è€Œ<code>assert!</code>å®çš„è¯ï¼Œåªèƒ½è¡¨ç¤ºå®ƒçš„å‚æ•°<code>==</code>è¡¨è¾¾å¼è¿”å›äº†ä¸€ä¸ª<code>false</code>ï¼Œè€Œä¸èƒ½ç¡®å®šå¯¼è‡´å®ƒå¤±è´¥çš„å…·ä½“å‚æ•°æ˜¯ä»€ä¹ˆã€‚</p> <p>æ¯”å¦‚å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†å®ƒçš„å‚æ•°+2ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32 <span class="token punctuation">{</span>
    a <span class="token operator">+</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">it_adds_two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">it_adds_three</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>æµ‹è¯•ç”¨ä¾‹è¿è¡Œç»“æœä¸ºå¦‚ä¸‹</p> <div class="language- extra-class"><pre><code>running 2 tests
test tests::it_adds_two ... ok
test tests::it_adds_three ... FAILED

failures:

---- tests::it_adds_three stdout ----
thread 'tests::it_adds_three' panicked at 'assertion failed: `(left == right)`
left: `5`,
right: `4`', src/lib.rs:16:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    tests::it_adds_three

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out

error: test failed, to rerun pass '--lib'
</code></pre></div><p>ç¬¬ä¸€ä¸ªç”¨ä¾‹é€šè¿‡ã€‚ç¬¬äºŒä¸ªç”¨ä¾‹ï¼Œç”±äºæˆ‘ä»¬æ–­è¨€ä¼ çš„å‚æ•°<code>add_two</code>çš„ç»“æœä¸º5ï¼Œå› æ­¤æµ‹è¯•ç»“æœä¸ºå¤±è´¥ã€‚å¹¶ä¸”æŒ‡å‡ºå®ƒçš„é”™è¯¯åŸå› æ˜¯å·¦å³å€¼ä¸æƒ³ç­‰ï¼Œä¸”<code>left</code>æ˜¯5ï¼Œ<code>right</code>æ˜¯4ã€‚ä¸€äº›æµ‹è¯•æ¡†æ¶å’Œè¯­è¨€ä¸­ï¼Œå¯èƒ½æŠŠç›¸ç­‰æ€§åˆ¤æ–­çš„ä¸¤ä¸ªå‚æ•°ç§°ä¸º<code>expected</code>å’Œ<code>actual</code>ã€‚Rustä¸­ç§°ä¸º<code>left</code>å’Œ<code>right</code>ã€‚å‚æ•°ä¼ é€’çš„é¡ºåºå¯¹æµ‹è¯•ç»“æœæ²¡æœ‰å½±å“ã€‚</p> <p><code>assert_ne!</code>å®è·Ÿå®ƒçš„ä½œç”¨ä¸€æ ·ï¼Œé€»è¾‘ç›¸åã€‚ä¸€èˆ¬neå‡½æ•°ç”¨äºé‚£äº›æˆ‘ä»¬ä¸ç¡®å®šç»“æœæ˜¯ä»€ä¹ˆå€¼ï¼Œä½†æ˜¯å¯ä»¥ç¡®å®šç»“æœä¸è¯¥æ˜¯æŸä¸ªå€¼çš„æƒ…å†µä¸‹ã€‚</p> <p>åœ¨æ¥å£åº•å±‚ï¼Œ<code>assert_eq!</code>å’Œ<code>assert_ne!</code>åˆ†åˆ«ä½¿ç”¨çš„æ˜¯<code>==</code>å’Œ<code>!=</code>è¿ç®—ç¬¦ã€‚å½“æµ‹è¯•ä¸é€šè¿‡æ—¶ï¼Œè¿™äº›å®é€šè¿‡debugæ ¼å¼åŒ–æ¥æ‰“å°å‚æ•°ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨äºæ¯”è¾ƒçš„å‚æ•°å€¼å¿…é¡»å®ç°<code>PartialEq</code>å’Œ<code>Debug</code>ä¸¤ä¸ªtraitã€‚æ‰€æœ‰åŸºç¡€ç±»å‹å’Œå¤§éƒ¨åˆ†æ ‡å‡†åº“æä¾›çš„ç±»å‹éƒ½å®ç°äº†è¿™ä¸¤ä¸ªtraitã€‚ä½ è‡ªå·±å®šä¹‰çš„structå’Œenumï¼Œéœ€è¦ä½ è‡ªå·±å®ç°<code>PartialEq</code>traitæ¥å®šä¹‰ç›¸ç­‰æ€§ã€‚å¦‚æœä½ éœ€è¦æµ‹è¯•ä¸é€šè¿‡æ—¶æ‰“å°å‚æ•°ä¿¡æ¯ï¼Œä½ è¿˜éœ€è¦å®ç°<code>Debug</code>æ¨¡å—ã€‚ç”±äºè¿™ä¸¤ä¸ªæ¨¡å—éƒ½æ˜¯å¯æ´¾ç”Ÿæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥åœ¨è‡ªå®šä¹‰çš„structå’Œenumå‰é¢åŠ <code>#[derive(PartialEq, Debug)]</code>ã€‚</p> <h3 id="æ·»åŠ è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯"><a href="#æ·»åŠ è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯" class="header-anchor">#</a> æ·»åŠ è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</h3> <p>ä½¿ç”¨<code>format!</code>å®è¯­æ³•ï¼Œå°†é”™è¯¯ä¿¡æ¯åŠ åœ¨æ–­è¨€å‡½æ•°çš„æœ€åã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">greeting</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span>
    String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// çœç•¥</span>
<span class="token function">assert!</span><span class="token punctuation">(</span>
    result<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Carol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// é”™è¯¯ä¿¡æ¯</span>
    <span class="token string">&quot;Greeting did not contain name, value was `{}`&quot;</span><span class="token punctuation">,</span>
    result
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="checking-for-panics-with-should-panic"><a href="#checking-for-panics-with-should-panic" class="header-anchor">#</a> Checking for Panics with should_panic</h3> <p>ä½¿ç”¨<code>should_panic</code>å±æ€§æ¥æ£€æµ‹ï¼Œä»£ç æ˜¯ä¸æ˜¯æŒ‰ç…§é¢„æœŸå‘ç”Ÿäº†panicã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> Guess <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Guess <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Guess <span class="token punctuation">{</span>
        <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> value <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token punctuation">{</span>
            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;Guess value must be between 1 and 100, got {}.&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        Guess <span class="token punctuation">{</span> value <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token attribute attr-name">#[should_panic]</span>
    <span class="token keyword">fn</span> <span class="token function">greater_than_100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Guess<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¿è¡Œç»“æœä¸ºokã€‚æˆ‘ä»¬ä¼ çš„å€¼æ˜¯200ï¼Œç¬¦åˆpanicçš„æ¡ä»¶ï¼Œå› æ­¤å‡½æ•°è°ƒç”¨<code>panic!</code>å®ã€‚è¿™ä¸ªé”™è¯¯è¢«<code>#[should_panic]</code>æ•è·åˆ°äº†ï¼Œæµ‹è¯•ç»“æœè·Ÿæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªæˆåŠŸçš„æµ‹è¯•ç”¨ä¾‹ã€‚æ¢å¥è¯è¯´ï¼Œ<code>should_panic</code>åªç”¨æ¥æ£€æµ‹é‚£äº›ä¼španicçš„æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿpanicï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨ä¾‹å°±æ˜¯å¤±è´¥ã€‚</p> <p>ä»…ä½¿ç”¨<code>should_panic</code>æ¥æ£€æµ‹panicä¸æ˜¯å¾ˆç²¾ç¡®ï¼Œå› ä¸ºå¯èƒ½ä»£ç ä¸­panicæ²¡æœ‰æºå¸¦æœ‰ç”¨ä¿¡æ¯ã€‚<code>should_panic</code>å¯ä»¥æ¥æ”¶å‚æ•°ï¼Œåœ¨panicå‘ç”Ÿæ—¶ï¼Œè¿™ä¸ªå‚æ•°ä¼šè·Ÿé”™è¯¯ä¿¡æ¯ä¸€èµ·æ‰“å°å‡ºæ¥ã€‚</p> <h3 id="åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨result-t-e"><a href="#åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨result-t-e" class="header-anchor">#</a> åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨<code>Result&lt;T, E&gt;</code></h3> <p>å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­<code>Result</code>æ¥æ›¿ä»£æ–­è¨€å®ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">{</span>
            <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">Err</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;two plus two does not equal four&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹è¿”å›ä¸€ä¸ª<code>Result</code>ã€‚åŒæ—¶å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹å†…éƒ¨ä½¿ç”¨é—®å·æ“ä½œç¬¦ã€‚å½“ä½¿ç”¨<code>Result</code>æ—¶ï¼Œä¸èƒ½ä½¿ç”¨<code>should_panic</code>å±æ€§ï¼Œæ­¤æ—¶å¿…é¡»æ˜¾å¼åœ°è¿”å›ä¸€ä¸ª<code>Err</code>ã€‚</p> <h2 id="section-2-controlling-how-tests-are-run"><a href="#section-2-controlling-how-tests-are-run" class="header-anchor">#</a> Section 2 - Controlling How Tests Are Run</h2> <p><code>cargo run</code>ç¼–è¯‘ä»£ç å¹¶ä¸”è¿è¡Œç»“æœå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒæ ·çš„ï¼Œ<code>cargo test</code>åœ¨æµ‹è¯•æ¨¡å¼ç¼–è¯‘ä»£ç ç„¶åè¿è¡Œæµ‹è¯•ç”¨ä¾‹å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®šå‘½ä»¤å‚æ•°ï¼Œæ¥æ”¹å˜<code>cargo test</code>çš„é»˜è®¤è¡Œä¸ºã€‚<code>cargo test</code>ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯ï¼šå¹¶è¡Œè¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œæ•è·æµ‹è¯•ç”¨ä¾‹çš„è¾“å‡ºä¿¡æ¯ï¼Œå¹¶åŠ å·¥æˆè·Ÿæµ‹è¯•ç”¨ä¾‹ç›¸å…³è”çš„ï¼Œé˜…è¯»å‹å¥½çš„è¾“å‡ºä¿¡æ¯ã€‚</p> <p>æŸäº›å‘½ä»¤è¡Œå‚æ•°æ˜¯ç»™<code>cargo test</code>æ‰§è¡Œçš„ï¼Œè€ŒæŸäº›æ˜¯ç»™ç¼–è¯‘å®Œçš„å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œçš„ã€‚ä¸ºäº†åŒºåˆ†è¿™ä¸¤ç§ç±»å‹çš„å‚æ•°ï¼Œç”¨äº<code>cargo test</code>æ‰§è¡Œçš„å‚æ•°è·Ÿåœ¨<code>--</code>åé¢ï¼Œç„¶ååé¢å†è·Ÿçš„æ˜¯ç»™å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œçš„å‚æ•°ã€‚</p> <h3 id="å¹¶è¡Œå’Œä¸²è¡Œ"><a href="#å¹¶è¡Œå’Œä¸²è¡Œ" class="header-anchor">#</a> å¹¶è¡Œå’Œä¸²è¡Œ</h3> <p>å½“æ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚å› æ­¤æµ‹è¯•ä»£ç å¯ä»¥æœ€å¿«è¿è¡Œå®Œæ¯•å¹¶ä¸”è¾“å‡ºæµ‹è¯•åé¦ˆã€‚ç”±äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ˜¯å•ç‹¬ä¸€ä¸ªçº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä¿è¯æ¯ä¸ªç”¨ä¾‹æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å…±äº«çŠ¶æ€æˆ–è€…å…±äº«ç¯å¢ƒç­‰ã€‚æ¯”å¦‚å¤šä¸ªæµ‹è¯•ç”¨ä¾‹æ˜¯å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œå½“å¹¶å‘è¿›è¡Œæ—¶ï¼Œæœ‰å¯èƒ½è¿›ç¨‹Aåœ¨è¯»çš„æ—¶å€™ï¼Œæ–‡ä»¶è¢«è¿›ç¨‹Bè¦†ç›–äº†ï¼Œå¯¼è‡´è¿›ç¨‹Aæµ‹è¯•å¤±è´¥ã€‚ç„¶è€Œè¿™å¹¶ä¸æ˜¯ç”±äºé€»è¾‘ä»£ç å¼•èµ·çš„é”™è¯¯ã€‚è§£å†³æ–¹æ³•æ˜¯æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éš”ç¦»æµ‹è¯•ç¯å¢ƒï¼Œæˆ–è€…ä¸²è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚</p> <p>ç”¨å‚æ•°<code>cargo test -- --test-threads=1</code>æŒ‡å®šæ‰§è¡Œçš„çº¿ç¨‹æ•°ã€‚</p> <h3 id="æ˜¾ç¤ºè¢«æµ‹è¯•å‡½æ•°çš„è¾“å‡ºä¿¡æ¯"><a href="#æ˜¾ç¤ºè¢«æµ‹è¯•å‡½æ•°çš„è¾“å‡ºä¿¡æ¯" class="header-anchor">#</a> æ˜¾ç¤ºè¢«æµ‹è¯•å‡½æ•°çš„è¾“å‡ºä¿¡æ¯</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRustä¼šå°†æµ‹è¯•é€šè¿‡ç”¨ä¾‹ä¸‹çš„å‡½æ•°è¾“å‡ºä¿¡æ¯å…¨éƒ¨æ•è·ï¼Œåªè¾“å‡ºæµ‹è¯•é€šè¿‡çš„ä¿¡æ¯ã€‚è€Œæµ‹è¯•ç”¨ä¾‹å¤±è´¥æ—¶ï¼Œæ‰€æœ‰ä¿¡æ¯ä¿¡æ¯éƒ½ä¼šè¢«è¾“å‡ºã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>
<span class="token keyword">fn</span> <span class="token function">prints_and_returns_10</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32 <span class="token punctuation">{</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;I got the value {}&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token number">10</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">this_test_will_pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">prints_and_returns_10</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">this_test_will_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">prints_and_returns_10</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>é»˜è®¤æµ‹è¯•ä¸Šé¢çš„ä»£ç ã€‚è¾“å‡ºä»¥ä¸‹ä¿¡æ¯</p> <div class="language- extra-class"><pre><code>running 2 tests
test tests::this_test_will_fail ... FAILED
test tests::this_test_will_pass ... ok

failures:

---- tests::this_test_will_fail stdout ----
I got the value 8
thread 'main' panicked at 'assertion failed: `(left == right)`
left: `5`,
right: `10`', src/lib.rs:19:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.


failures:
    tests::this_test_will_fail

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out

error: test failed, to rerun pass '--lib'
</code></pre></div><p>é€šè¿‡<code>cargo test -- --show-output</code>å‚æ•°ï¼Œè¾“å‡ºæµ‹è¯•ç”¨ä¾‹ä¿¡æ¯ä»¥åŠå‡½æ•°æœ¬èº«çš„è¾“å‡ºä¿¡æ¯ã€‚</p> <div class="language- extra-class"><pre><code>running 2 tests
test tests::this_test_will_fail ... FAILED
test tests::this_test_will_pass ... ok

successes:

---- tests::this_test_will_pass stdout ----
I got the value 4


successes:
    tests::this_test_will_pass

failures:

---- tests::this_test_will_fail stdout ----
I got the value 8
thread 'main' panicked at 'assertion failed: `(left == right)`
left: `5`,
right: `10`', src/lib.rs:19:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.


failures:
    tests::this_test_will_fail

test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out

error: test failed, to rerun pass '--lib'
</code></pre></div><h3 id="running-a-subset-of-tests-by-name"><a href="#running-a-subset-of-tests-by-name" class="header-anchor">#</a> Running a Subset of Tests by Name</h3> <p>é€šè¿‡æŒ‡å®šæµ‹è¯•ç”¨ä¾‹åç§°æ¥è¿è¡Œç‰¹å®šçš„æµ‹è¯•ç”¨ä¾‹ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32 <span class="token punctuation">{</span>
    a <span class="token operator">+</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">add_two_and_two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">add_three_and_two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">one_hundred</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>é»˜è®¤è¿è¡Œæµ‹è¯•ç”¨ä¾‹<code>cargo test</code>æ—¶ï¼Œæ‰€æœ‰çš„ç”¨ä¾‹éƒ½ä¼šè¢«æ‰§è¡Œï¼š</p> <div class="language- extra-class"><pre><code>running 3 tests
test tests::add_three_and_two ... ok
test tests::add_two_and_two ... ok
test tests::one_hundred ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><h4 id="è¿è¡Œå•ä¸ªæµ‹è¯•"><a href="#è¿è¡Œå•ä¸ªæµ‹è¯•" class="header-anchor">#</a> è¿è¡Œå•ä¸ªæµ‹è¯•</h4> <p><code>cargo test [test_name]</code>ï¼Œä¾‹å¦‚<code>cargo test one_hundred</code>ã€‚</p> <div class="language- extra-class"><pre><code>running 1 test
test tests::one_hundred ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 2 filtered out
</code></pre></div><p>å¯ä»¥çœ‹åˆ°è¾“å‡ºä¿¡æ¯ä¸­è¯´æ˜<code>2 filtered out</code>ï¼Œæœ‰ä¸¤ä¸ªç”¨ä¾‹è¢«è¿‡æ»¤æ‰äº†ã€‚</p> <h4 id="è¿è¡Œå¤šä¸ªæµ‹è¯•"><a href="#è¿è¡Œå¤šä¸ªæµ‹è¯•" class="header-anchor">#</a> è¿è¡Œå¤šä¸ªæµ‹è¯•</h4> <p>æˆ‘ä»¬å¯ä»¥åœ¨æŒ‡å®šæµ‹è¯•ç”¨ä¾‹åç§°æ—¶ï¼ŒåªæŒ‡å®šå…¶ä¸­çš„ä¸€éƒ¨åˆ†åç§°ã€‚Rustä¼šè¿è¡Œæ‰€æœ‰åç§°åŒ…å«æˆ‘ä»¬å‚æ•°çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä¾‹å¦‚<code>cargo test add</code></p> <div class="language- extra-class"><pre><code>running 2 tests
test tests::add_three_and_two ... ok
test tests::add_two_and_two ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out
</code></pre></div><p>æœ‰ä¸¤ä¸ªç”¨ä¾‹åç§°åŒ…å«addï¼Œæ‰€ä»¥ä»–ä»¬éƒ½è¢«è¿è¡Œäº†ã€‚</p> <h3 id="é»˜è®¤è¿‡æ»¤æŸäº›ç”¨ä¾‹é™¤éæ˜ç¡®æŒ‡å®š"><a href="#é»˜è®¤è¿‡æ»¤æŸäº›ç”¨ä¾‹é™¤éæ˜ç¡®æŒ‡å®š" class="header-anchor">#</a> é»˜è®¤è¿‡æ»¤æŸäº›ç”¨ä¾‹é™¤éæ˜ç¡®æŒ‡å®š</h3> <p>åœ¨æµ‹è¯•ç”¨ä¾‹å‰åŠ <code>ignore</code>å‚æ•°æ¥é»˜è®¤è·³è¿‡è¯¥ç”¨ä¾‹ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token attribute attr-name">#[ignore]</span>
<span class="token keyword">fn</span> <span class="token function">expensive_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// code that takes an hour to run</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¿è¡Œ<code>cargo test</code>æ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹</p> <div class="language- extra-class"><pre><code>running 2 tests
test expensive_test ... ignored
test it_works ... ok

test result: ok. 1 passed; 0 failed; 1 ignored; 0 measured; 0 filtered out

Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><p>å¯ä»¥çœ‹å‡º<code>expensive_test</code>æ˜¾ç¤ºè¢«è·³è¿‡äº†ã€‚</p> <p>å¢åŠ <code>cargo test -- --ignore</code>å‚æ•°ï¼Œè¿è¡Œæœ‰<code>ignore</code>å±æ€§çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p> <div class="language- extra-class"><pre><code>running 1 test
test expensive_test ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out

Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><p>å¯ä»¥å°†ä¸€äº›è€—æ—¶ä»»åŠ¡æ ‡è®°ä¸º<code>ignore</code>å•ç‹¬æ‰§è¡Œã€‚</p> <h2 id="section-3-test-organization"><a href="#section-3-test-organization" class="header-anchor">#</a> Section 3 - Test Organization</h2> <p>Rustç¤¾åŒºè®¤ä¸ºæµ‹è¯•ä¸»è¦åˆ†ä¸ºï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚å•å…ƒæµ‹è¯•æ›´å°æ›´é›†ä¸­ï¼ŒåŒä¸€æ—¶é—´åªéš”ç¦»æµ‹è¯•ä¸€ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”å¯ä»¥æµ‹è¯•ç§æœ‰æ¥å£ã€‚é›†æˆæµ‹è¯•æ›´ç³»ç»ŸåŒ–ï¼ŒåŒ…å«èŒƒå›´å¯èƒ½å»¶å±•åˆ°æˆ‘ä»¬æ•´ä¸ªåº“ï¼Œä¸”ä»…æµ‹è¯•å…¬æœ‰æ¥å£ã€‚</p> <h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="header-anchor">#</a> å•å…ƒæµ‹è¯•</h3> <p>å•å…ƒæµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨éš”ç¦»ç¯å¢ƒä¸‹å¿«é€Ÿåœ°æµ‹è¯•æŸä¸ªå•ä¸€æ¨¡å—æ˜¯å¦èƒ½æŒ‰é¢„æœŸè¿è¡Œã€‚å•å…ƒæµ‹è¯•æ”¾åœ¨srcç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶ä¸­ï¼Œé‡Œé¢åŒ…å«è¦æµ‹è¯•çš„ä»£ç ã€‚æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯æ¯ä¸ªæ–‡ä»¶ä¸­éƒ½åˆ›å»ºä¸€ä¸ªtestæ¨¡å—ï¼Œå¹¶ä¸”å¸¦æµ‹è¯•æ¨¡å—å‰åŠ <code>#[cfg(test)]</code>æ³¨é‡Šã€‚</p> <h4 id="the-tests-module-and-cfg-test"><a href="#the-tests-module-and-cfg-test" class="header-anchor">#</a> The Tests Module and #[cfg(test)]</h4> <p><code>#[cfg(test)]</code>æ³¨é‡Šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåªæœ‰å½“è¿è¡Œ<code>cargo test</code>å‘½ä»¤æ—¶ï¼Œæ‰è¿›è¡Œè¿™äº›æµ‹è¯•ç”¨ä¾‹ï¼Œ<code>cargo build</code>çš„æ—¶å€™ä¸è¿è¡Œè¿™äº›æµ‹è¯•ç”¨ä¾‹ã€‚è¿™æ ·å¯ä»¥ç¼©çŸ­ç¼–è¯‘æ—¶é—´ï¼Œè€Œä¸”ä¸åŒ…å«æµ‹è¯•ç”¨ä¾‹ä»£ç ï¼Œä¹Ÿæ§åˆ¶äº†ç¼–è¯‘ç»“æœæ–‡ä»¶çš„å¤§å°ã€‚ç”±äºé›†æˆæµ‹è¯•åœ¨å…¶ä»–çš„ç›®å½•ä¸­ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿™ä¸ªæ³¨é‡Šã€‚ç”±äºå•å…ƒæµ‹è¯•å’Œé€»è¾‘ä»£ç æ˜¯åœ¨ä¸€èµ·çš„ï¼Œå› æ­¤éœ€è¦å°†ä»–ä»¬æ ‡è®°ï¼Œä¸è¦æ„å»ºåˆ°æœ€ç»ˆçš„ç»“æœä¸­ã€‚</p> <p>ä¹‹å‰æˆ‘ä»¬æ–°å»ºlibé¡¹ç›®æ—¶ï¼Œcargoè‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªæµ‹è¯•æ¨¡å—ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>cfg</code>ä»£è¡¨é…ç½®å¹¶ä¸”å‘Šè¯‰ç¼–è¯‘å™¨ä¸‹é¢çš„å†…å®¹åªæœ‰æ»¡è¶³äº†è¯¥é…ç½®æ—¶ï¼Œæ‰ä¼šè¢«ç¼–è¯‘ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¨¡å—é…ç½®æ˜¯<code>test</code>ï¼Œè¿™æ˜¯Rustæä¾›çš„ç”¨æ¥ç¼–è¯‘å’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„ã€‚åªæœ‰å½“æˆ‘ä»¬è¿è¡Œ<code>cargo test</code>æ—¶Cargoæ‰ä¼šç¼–è¯‘è¯¥æµ‹è¯•ä»£ç ã€‚é™¤äº†æµ‹è¯•æ¨¡å—ä¸‹çš„æµ‹è¯•ç”¨ä¾‹ä¸ä¼šè¢«ç¼–è¯‘ï¼Œå…¶ä»–çš„ä¸€äº›å¸®åŠ©å‡½æ•°ä¹Ÿä¸ä¼šè¢«ç¼–è¯‘ã€‚</p> <h4 id="testing-private-functions"><a href="#testing-private-functions" class="header-anchor">#</a> Testing Private Functions</h4> <p>ç¤¾åŒºä¸€ç›´æœ‰äº‰è®ºï¼Œç§æœ‰æ¥å£åº”ä¸åº”è¯¥ç›´æ¥å»æµ‹è¯•ç§æœ‰æ¥å£ã€‚å…¶ä»–è¯­è¨€æµ‹è¯•ç§æœ‰æ¥å£æ˜¯å¾ˆå›°éš¾çš„ã€‚ä¸è®ºä½ æŒä½•ç§è§‚å¿µï¼ŒRustç§æœ‰è§„åˆ™éƒ½å…è®¸ä½ ç›´æ¥æµ‹è¯•ç§æœ‰æ¥å£ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32 <span class="token punctuation">{</span>
    <span class="token function">internal_adder</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">internal_adder</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> b<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32 <span class="token punctuation">{</span>
    a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> tests <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function">internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token function">internal_adder</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><code>internal_adder</code>å‡½æ•°æ²¡æœ‰<code>pub</code>å…³é”®å­—ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥åœ¨<code>tests</code>æ¨¡å—ä¸­å¼•å…¥æµ‹è¯•ã€‚Rustä¸å¼ºåˆ¶æµ‹è¯•ç§æœ‰æ¥å£ã€‚</p> <h3 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="header-anchor">#</a> é›†æˆæµ‹è¯•</h3> <p>Rustä¸­çš„é›†æˆæµ‹è¯•ä»£ç å®Œå…¨å¤„äºä½ çš„åº“ä¹‹å¤–ã€‚é›†æˆæµ‹è¯•è°ƒç”¨åº“çš„æ–¹å¼å’Œå…¶ä»–ä»£ç ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´é›†æˆæµ‹è¯•å¯ä»¥åªè°ƒç”¨éƒ¨åˆ†APIã€‚é›†æˆæµ‹è¯•çš„ç›®çš„æ˜¯æ£€æµ‹ä½ çš„åº“ä¸­å¤šä¸ªæ¨¡å—ä¸€èµ·å·¥ä½œæ—¶æ­£ç¡®ä¸å¦ã€‚å³ä½¿å•å…ƒæµ‹è¯•é€šè¿‡ï¼Œé›†æˆæµ‹è¯•æœ‰å¯èƒ½ä¹Ÿä¼šå‡ºç°é—®é¢˜ã€‚åˆ›å»ºé›†æˆæµ‹è¯•é¦–å…ˆéœ€è¦åˆ›å»º<em>tests</em>ç›®å½•ã€‚</p> <h4 id="testsç›®å½•"><a href="#testsç›®å½•" class="header-anchor">#</a> testsç›®å½•</h4> <p>åœ¨äº<em>src</em>ç›®å½•åŒçº§çš„æ ¹ç›®å½•ä¸‹åˆ›å»º<em>tests</em>ç›®å½•ï¼ŒCargoä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹æŸ¥æ‰¾é›†æˆæµ‹è¯•æ–‡ä»¶ã€‚ç„¶åå¯ä»¥ä»»æ„åœ¨è¿™ä¸ªç›®å½•ä¸‹æ·»åŠ æµ‹è¯•æ–‡ä»¶ï¼ŒCargoä¼šå°†è¿™äº›æ–‡ä»¶ç¼–è¯‘æˆç‹¬ç«‹çš„crateã€‚</p> <p>è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªé›†æˆæµ‹è¯•ç›®å½•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶<em>tests/integration_test.rs</em>ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> adder<span class="token punctuation">;</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">it_adds_two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> adder<span class="token punctuation">::</span><span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç ä¸éœ€è¦ç”¨<code>#[cfg(test)]</code>æ ‡æ³¨ï¼ŒRustä¼šå¯¹<em>tests</em>ç›®å½•ä¸‹çš„æ–‡ä»¶ç‰¹æ®Šå¤„ç†ï¼Œåªæœ‰è¿è¡Œ<code>cargo test</code>çš„æ—¶å€™æ‰ä¼šç¼–è¯‘è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚è¿è¡Œ<code>cargo test</code>çœ‹ä¸‹æ•ˆæœã€‚</p> <div class="language- extra-class"><pre><code>  Compiling adder v0.1.0 (/Users/ksleo/private/rust_learn/adder)
   Finished test [unoptimized + debuginfo] target(s) in 1.07s
    Running target/debug/deps/adder-9d658908b5cc4b63

running 1 test
test tests::internal ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

    Running target/debug/deps/integration_test-48170a4e87fe33c4

running 1 test
test it_adds_two ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

    Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸‰å—å†…å®¹è¾“å‡ºï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ–‡æ¡£æµ‹è¯•ã€‚ä½¿ç”¨<code>--test &lt;testname&gt;</code>å¯ä»¥ä»…æ‰§è¡ŒæŸéƒ¨åˆ†é›†æˆæµ‹è¯•ã€‚</p> <h3 id="submodules-in-integration-tests"><a href="#submodules-in-integration-tests" class="header-anchor">#</a> Submodules in Integration Tests</h3> <p>å½“ä½ çš„é›†æˆæµ‹è¯•è¶Šæ¥è¶Šå¤šæ—¶ï¼Œä½ å¯èƒ½æƒ³è¦æŠŠè¿™äº›æµ‹è¯•ç»„ç»‡åˆ°<em>test</em>ç›®å½•ä¸‹ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚æ¯”å¦‚ï¼Œå¯ä»¥æŒ‰ç…§æµ‹è¯•çš„å‡½æ•°åŠŸèƒ½æ¥ç»„ç»‡æµ‹è¯•ç”¨ä¾‹ã€‚ä¹‹å‰å·²ç»æåˆ°è¿‡ï¼Œé›†æˆæµ‹è¯•ä¼šè¢«ç¼–è¯‘æˆå•ç‹¬çš„crateã€‚</p> <p>æŠŠé›†æˆæµ‹è¯•å½“ä½œç‹¬ç«‹çš„crateï¼Œæœ‰åŠ©äºåˆ›å»ºç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œè®©é›†æˆæµ‹è¯•çš„åœºæ™¯æ›´æ¥è¿‘å…¶ä»–ç”¨æˆ·è°ƒç”¨ä½ çš„crateçš„çœŸå®åœºæ™¯ã€‚</p> <p>å½“æˆ‘ä»¬åœ¨<em>tests</em>ç›®å½•ä¸‹ï¼Œæƒ³æŠ½è±¡ä¸€äº›é€šç”¨ä»£ç ä¾›å„ä¸ªé›†æˆæµ‹è¯•è°ƒç”¨æ—¶ï¼ŒRustä¼šæŠŠè¿™å†™é€šç”¨ä»£ç ä¹Ÿå½“ä½œé›†æˆæµ‹è¯•ç¼–è¯‘æˆå•ç‹¬çš„crateã€‚ä¾‹å¦‚ï¼Œåˆ›å»º<em>tests/common.rs</em>æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸€ä¸ª<code>setup</code>å‡½æ•°ã€‚</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// something</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨è¿è¡Œ<code>cargo test</code>æ—¶ï¼Œä¼šå‘ç°æµ‹è¯•ç»“æœè¾“å‡ºå¤šäº†ä¸€å—ã€‚</p> <div class="language- extra-class"><pre><code>    Running target/debug/deps/common-7064e1b6d2e271be

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre></div><p><em>common.rs</em>ä¸­çš„å†…å®¹è¢«å½“ä½œæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå’Œæ‰“å°ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æˆ‘ä»¬åªæƒ³å®ƒé‡Œé¢çš„ä»£ç ä¾›å…¶ä»–æµ‹è¯•ç”¨ä¾‹è°ƒç”¨ã€‚å¯ä»¥é€šè¿‡åˆ›å»º<em>tests/mod/common.rs</em>æ¥ä»£æ›¿ï¼ŒRustä¸ä¼šå°†è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å½“ä½œé›†æˆæµ‹è¯•æ¥å¤„ç†ã€‚æ­¤æ—¶ï¼Œæµ‹è¯•ç»“æœè¾“å‡ºä¸­ä¹Ÿä¸ä¼šåŒ…å«ç›¸åº”çš„å†…å®¹äº†ã€‚</p> <p>å½“æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªé€šç”¨ä»£ç ä¹‹åï¼Œå°±å¯ä»¥åœ¨å…¶ä»–é›†æˆæµ‹è¯•æ–‡ä»¶ä¸­è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> adder<span class="token punctuation">;</span>

<span class="token keyword">mod</span> common<span class="token punctuation">;</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function">it_adds_two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    common<span class="token punctuation">::</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> adder<span class="token punctuation">::</span><span class="token function">add_two</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>æ³¨æ„<code>mod common;</code>çš„å†™æ³•ï¼Œä¹‹å‰è®²è¿‡åˆ†å·ç»“å°¾æ˜¯å°†è¯¥æ¨¡å—å¼•å…¥ã€‚</p></blockquote> <h3 id="integration-tests-for-binary-crates"><a href="#integration-tests-for-binary-crates" class="header-anchor">#</a> Integration Tests for Binary Crates</h3> <p>å¦‚æœä½ çš„é¡¹ç›®åªæœ‰<em>src/main.rs</em>ï¼Œå³ä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œcrateï¼Œæ­¤æ—¶ä¸èƒ½åˆ›å»ºé›†æˆæµ‹è¯•ã€‚åªæœ‰åº“crateæ‰èƒ½åˆ›å»ºé›†æˆæµ‹è¯•ï¼Œåº“crateå¯¼å‡ºçš„æ–¹æ³•æ‰èƒ½è¢«å…¶ä»–crateç”¨useå¯¼å…¥å’Œä½¿ç”¨ã€‚å¯æ‰§è¡Œcrateå¯¼å‡ºçš„å‡½æ•°åªèƒ½å†…éƒ¨ä½¿ç”¨ã€‚</p> <p>è¿™ä¹Ÿæ˜¯Rusté¡¹ç›®åœ¨<em>src/main.rs</em>æ–‡ä»¶ä¸­åªè°ƒç”¨<em>src/lib.rs</em>é€»è¾‘çš„åŸå› ä¹‹ä¸€ã€‚ä½¿ç”¨è¿™ç§æ¶æ„çš„è¯ï¼Œé›†æˆæµ‹è¯•æ¥æµ‹è¯•å ç»å¤§éƒ¨åˆ†æ¯”ä¾‹çš„åº“crateä»£ç ä¸­çš„åŠŸèƒ½ï¼Œè€Œ<em>src/main.rs</em>ä¸­æå°‘æ¯”ä¾‹ä¸”å‡ ä¹ä¸å«åŠŸèƒ½é€»è¾‘çš„è°ƒç”¨ä»£ç ä¸éœ€è¦æµ‹è¯•ï¼Œä»…éœ€è¦é˜…è¯»å°±å¯ä»¥åˆ¤æ–­å…¶æ˜¯å¦æ­£ç¡®è¿è¡Œã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f46cf57.js" defer></script><script src="/assets/js/2.49ce1412.js" defer></script><script src="/assets/js/14.e42e08a4.js" defer></script>
  </body>
</html>
