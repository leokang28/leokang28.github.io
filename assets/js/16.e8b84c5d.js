(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{363:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"chapter-11-关于cargo和crates-io"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chapter-11-关于cargo和crates-io"}},[s._v("#")]),s._v(" Chapter 11 - 关于Cargo和Crates.io")]),s._v(" "),t("p",[s._v("目前为止我们只使用到cargo创建、运行、测试、构建等基础功能。本章会介绍它的其他功能。包括：")]),s._v(" "),t("ul",[t("li",[s._v("使用配置文件定制构建")]),s._v(" "),t("li",[s._v("在"),t("a",{attrs:{href:"https://crates.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),t("OutboundLink")],1),s._v("发布库")]),s._v(" "),t("li",[s._v("使用工作空间管理大型项目")]),s._v(" "),t("li",[s._v("安装"),t("a",{attrs:{href:"https://crates.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),t("OutboundLink")],1),s._v("上的可执行文件")]),s._v(" "),t("li",[s._v("定制化命令扩展cargo")])]),s._v(" "),t("p",[s._v("可以在"),t("a",{attrs:{href:"https://doc.rust-lang.org/cargo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("cargo官方文档"),t("OutboundLink")],1),s._v("查看全部功能说明。")]),s._v(" "),t("h2",{attrs:{id:"section-1-使用配置文件定制构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-1-使用配置文件定制构建"}},[s._v("#")]),s._v(" Section 1 - 使用配置文件定制构建")]),s._v(" "),t("p",[s._v("Rust中，*配置文件（release profiles）*是预定义的、可自定义的文件，不同的配置选项可以对代码编译进行控制。每个文件的配置都是独立的。")]),s._v(" "),t("p",[s._v("cargo有两个主要的配置文件")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("dev")]),s._v("配置文件。"),t("code",[s._v("cargo build")]),s._v("命令会使用这个配置文件。包含针对开发环境的默认配置")]),s._v(" "),t("li",[t("code",[s._v("release")]),s._v("配置文件。"),t("code",[s._v("cargo build --release")]),s._v("命令会使用这个配置文件。包含针对发布环境的默认配置。")])]),s._v(" "),t("p",[s._v("当"),t("em",[s._v("Cargo.toml")]),s._v("文件中没有"),t("code",[s._v("[profile.*]")]),s._v("声明时，cargo会使用默认配置。对想要修改的配置文件加"),t("code",[s._v("[profile.*]")]),s._v("声明，就可以对默认配置进行覆盖和定制化。例如：")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("profile.dev")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("opt-level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("profile.release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("opt-level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("分别对"),t("code",[s._v("dev")]),s._v("和"),t("code",[s._v("release")]),s._v("配置文件，针对"),t("code",[s._v("opt-level")]),s._v("配置进行了定制化。")]),s._v(" "),t("h2",{attrs:{id:"section-2-发布crate到crates-io"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-2-发布crate到crates-io"}},[s._v("#")]),s._v(" Section 2 - 发布Crate到Crates.io")]),s._v(" "),t("p",[s._v("Rust和Cargo有很多功能，辅助包发布和查找。首先介绍三个功能然后再介绍如何发布自己的包。")]),s._v(" "),t("h3",{attrs:{id:"有用的文档注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#有用的文档注释"}},[s._v("#")]),s._v(" 有用的文档注释")]),s._v(" "),t("p",[s._v("准确描述你的包有助于让其他人更容易地了解如何使用、何时使用你的包，所以有用的文档很有必要。代码注释时使用双斜线"),t("code",[s._v("//")]),s._v("，Rust也有专门针对文档的注释，称之为"),t("em",[s._v("文档注释（documentation comment）")]),s._v("，文档注释会用来生成html页面。html展示了你对公开API的介绍，文档内容应当是介绍如何使用你的API，而不是描述你如何实现的这些API。")]),s._v(" "),t("p",[s._v("文档注释使用三斜线"),t("code",[s._v("///")]),s._v("，并且支持md语法。文档注释放置于被描述对象之前。例如我们创建一个"),t("code",[s._v("my_crate")]),s._v("库，里面包含一个"),t("code",[s._v("add_one")]),s._v("函数。")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// Adds one to the number given.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("///")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # Examples")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("///")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// let arg = 5;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// let answer = my_crate::add_one(arg);")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("///")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// assert_eq!(6, answer);")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("我们描述了"),t("code",[s._v("add_one")]),s._v("函数的功能是什么，然后"),t("code",[s._v("Examples")]),s._v("下面是一个示例代码块。"),t("code",[s._v("cargo doc")]),s._v("命令可以基于这些描述生成html文档。这个命令运行了Rust提供的"),t("code",[s._v("rustdoc")]),s._v("工具，并且将生成的html文件放置于"),t("em",[s._v("target/doc")]),s._v("目录下。")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("--open")]),s._v("参数会在文档创建完成之后打开浏览器，效果如下：\n"),t("img",{attrs:{src:"https://gitee.com/ksleo/source/raw/master/QQ20200901-165110@2x.png",alt:"rust doc"}})]),s._v(" "),t("h4",{attrs:{id:"常用模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用模块"}},[s._v("#")]),s._v(" 常用模块")]),s._v(" "),t("p",[s._v("我们已经使用"),t("code",[s._v("# Examples")]),s._v("md语法，创建了一个示例代码模块，下面还有一些常用的模块：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("Panics")]),s._v("：会导致代码出错的场景。")]),s._v(" "),t("li",[t("strong",[s._v("Errors")]),s._v("：如果函数返回的是一个"),t("code",[s._v("Result")]),s._v("，描述一下返回的错误类型，以及如何处理这些错误。")]),s._v(" "),t("li",[t("strong",[s._v("Safety")]),s._v("：如果这个函数调用是"),t("code",[s._v("unsafe")]),s._v("的，应当描述函数为何是"),t("code",[s._v("unsale")]),s._v("，以及涵盖希望由调用者维护的不变性（invariants）。")])]),s._v(" "),t("h4",{attrs:{id:"文档注释测试用例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文档注释测试用例"}},[s._v("#")]),s._v(" 文档注释测试用例")]),s._v(" "),t("p",[t("code",[s._v("cargo test")]),s._v("命令会将文档注释中examples模块下的示例代码作为测试用例运行。这会保证你的代码和示例代码是同步的，因为当你修改其中任意部分时，如果出错文档测试会捕获到。")]),s._v(" "),t("h4",{attrs:{id:"目录性描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录性描述"}},[s._v("#")]),s._v(" 目录性描述")]),s._v(" "),t("p",[s._v("对crate包含内容的一个总体描述。")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! # My Crate")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! `my_crate` is a collection of utilities to make performing certain")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! calculations more convenient.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// Adds one to the number given.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://gitee.com/ksleo/source/raw/master/QQ20200901-171515@2x.png",alt:"rust doc"}})]),s._v(" "),t("h3",{attrs:{id:"使用pub-use导出公有api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用pub-use导出公有api"}},[s._v("#")]),s._v(" 使用"),t("code",[s._v("pub use")]),s._v("导出公有API")]),s._v(" "),t("p",[s._v("在写代码时，你的代码结构可能自己比较清楚，但对于使用者来说可能不是特别方便。在组织代码时，可能进行了很深的模块嵌套，但是当使用者想要使用一个定义的很深的API时，找到它就比较费劲了。例如："),t("code",[s._v("use my_crate::some_module::another_module::UsefulType;")]),s._v("。显然"),t("code",[s._v("use my_crate::UsefulType")]),s._v("对调用者更加的友好。")]),s._v(" "),t("p",[s._v("因此当发布包时，API的结构是首先要考虑的问题。因为使用者不会像你一样熟悉你的代码结构。")]),s._v(" "),t("p",[s._v("当一个API对调用者不太友好时，你不需要修改你的代码组织，你可以使用"),t("code",[s._v("pub use")]),s._v("二次导出。"),t("code",[s._v("pub use")]),s._v("导入一个共有API，并且将其再对外公开暴露。")]),s._v(" "),t("p",[s._v("创建一个"),t("code",[s._v("art")]),s._v("包，它的内容如下所示：")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! # Art")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! A library for modeling artistic concepts.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" kinds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// The primary colors according to the RYB color model.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" PrimaryColor "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Red"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        Yellow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        Blue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// The secondary colors according to the RYB color model.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" SecondaryColor "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Orange"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        Green"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        Purple"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" utils "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("crate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// Combines two primary colors in equal amounts to create")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// a secondary color.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" SecondaryColor "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// --snip--")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("查看它的文档：\n"),t("img",{attrs:{src:"https://gitee.com/ksleo/source/raw/master/QQ20200901-173414@2x.png",alt:"rust doc"}})]),s._v(" "),t("p",[t("code",[s._v("PrimaryColor")]),s._v("、"),t("code",[s._v("SecondaryColor")]),s._v("和"),t("code",[s._v("mix")]),s._v("都没有在首页展示出来，需要我们手动点入这些模块。并且其他模块调用我们的包时，引用的链路特别长：")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" art"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" art"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("utils"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" red "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("Red"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" yellow "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("Yellow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("red"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" yellow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("为了移除这个调用者冗长的调用链路，我们可以在自己的包中，将这些API进行二次导出：")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("SecondaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("utils"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("code",[s._v("PrimaryColor")]),s._v("、"),t("code",[s._v("SecondaryColor")]),s._v("和"),t("code",[s._v("mix")]),s._v("都更容易找到了，文档如下：\n"),t("img",{attrs:{src:"https://gitee.com/ksleo/source/raw/master/QQ20200901-174144@2x.png",alt:"rust doc"}})]),s._v(" "),t("p",[s._v("并且调用者在引用代码，代码量也更少：")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" art"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" art"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"创建crates-io账号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建crates-io账号"}},[s._v("#")]),s._v(" 创建Crates.io账号")]),s._v(" "),t("p",[s._v("首先去"),t("a",{attrs:{href:"https://crates.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),t("OutboundLink")],1),s._v("注册一个账号，验证邮箱之后，获取API token。然后在终端使用token登陆。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("cargo login abcdefghijklmnopqrstuvwxyz012345\n")])])]),t("p",[s._v("token会被存储在*~/.cargo/credentials.*文件下。注意不要将token分享出去。")]),s._v(" "),t("h3",{attrs:{id:"为新包添加元数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为新包添加元数据"}},[s._v("#")]),s._v(" 为新包添加元数据")]),s._v(" "),t("p",[s._v("发布之前需要在"),t("em",[s._v("Cargo.toml")]),s._v("文件的[package]模块下追加一些元数据。")]),s._v(" "),t("p",[s._v("注意你的包名必须是唯一的。当你在本地开发时，跟目录名称可以随意，但是在发布时，元数据当中的包名称必须是唯一的，不能跟别人的包名称冲突。因此在发布之前可以去网站上先搜索一下你的名字有没有被使用。")]),s._v(" "),t("p",[t("em",[s._v("Cargo.toml")]),s._v("文件下的[package]模块中定义包名称：")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("package")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ksleo_public_test"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("当你选好唯一的名称之后，使用"),t("code",[s._v("cargo publish")]),s._v("发布，会出现一个错误")]),s._v(" "),t("blockquote",[t("p",[s._v("error: api errors (status 200 OK): missing or empty metadata fields: description, license. Please see https://doc.rust-lang.org/cargo/reference/manifest.html for how to upload metadata")])]),s._v(" "),t("p",[s._v("因为你的项目还缺少一些关键信息：描述和证书。描述你的包是做什么用，并且你的包是基于什么证书给别人使用的。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("package")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("license")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("description")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"just for pub test"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("在[package]模块下加入这些内容后，就可以成功发布了。")]),s._v(" "),t("h3",{attrs:{id:"发布新版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布新版本"}},[s._v("#")]),s._v(" 发布新版本")]),s._v(" "),t("p",[s._v("修改"),t("em",[s._v("Cargo.toml")]),s._v("文件下的版本号，重新发布即可。")]),s._v(" "),t("h3",{attrs:{id:"使用cargo-yank禁用版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用cargo-yank禁用版本"}},[s._v("#")]),s._v(" 使用"),t("code",[s._v("cargo yank")]),s._v("禁用版本")]),s._v(" "),t("p",[s._v("cargo不支持删除某个历史版本，但可以将历史版本禁用，防止其他人将该版本加入依赖。")]),s._v(" "),t("p",[s._v("yanking只能防止新项目将该版本作为依赖，已存在的项目依旧可以下载该版本。")]),s._v(" "),t("p",[s._v("下面的命令就将1.0.1版本禁用了，任何新项目都不能再依赖该版本")]),s._v(" "),t("blockquote",[t("p",[s._v("$ cargo yank --vers 1.0.1")])]),s._v(" "),t("p",[s._v("如果要撤销某个版本的禁用，可以使用"),t("code",[s._v("--undo")]),s._v("参数")]),s._v(" "),t("blockquote",[t("p",[s._v("$ cargo yank --vers 1.0.1 --undo")])]),s._v(" "),t("h2",{attrs:{id:"section-3-cargo工作空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-3-cargo工作空间"}},[s._v("#")]),s._v(" Section 3 - Cargo工作空间")]),s._v(" "),t("p",[s._v("在开发过程中，你的包会变得越来越大，此时应该对它们进一步切分。在这种场景下，Cargo提供了*工作空间（work space）*的功能让你来管理一些相关的包。")]),s._v(" "),t("h3",{attrs:{id:"创建工作空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建工作空间"}},[s._v("#")]),s._v(" 创建工作空间")]),s._v(" "),t("p",[s._v("工作空间是一组共享"),t("em",[s._v("Cargo.toml")]),s._v("文件和输出目录的包集合。创建工作空间有很多方式，下面展示最常用的一种。我们将创建包含1个可执行crate和1个库crate的工作空间。可执行crate提供入口函数"),t("code",[s._v("main")]),s._v("，其余库crate提供方法。")]),s._v(" "),t("p",[s._v("首先创建一个"),t("em",[s._v("add")]),s._v("目录。然后进入目录创建"),t("em",[s._v("Cargo.toml")]),s._v("文件。这个toml文件不会包含之前出现的[package]块，或者其他元数据。它以[workspace]块开始，下面会定义工作空间所包含的成员。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("workspace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("members")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"adder"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("然后在"),t("em",[s._v("add")]),s._v("目录下新建一个可执行包"),t("code",[s._v("adder")]),s._v("。最后使用"),t("code",[s._v("cargo build")]),s._v("创建工作空间，此时项目结构应该如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("├── Cargo.lock\n├── Cargo.toml\n├── adder\n│   ├── Cargo.toml\n│   └── src\n│       └── main.rs\n└── target\n")])])]),t("p",[s._v("工作空间根目录有一个放置编译结果的"),t("em",[s._v("target")]),s._v("目录，adder包内部没有"),t("em",[s._v("target")]),s._v("目录了。就算我们进入"),t("em",[s._v("adder")]),s._v("项目运行"),t("code",[s._v("Cargo build")]),s._v("，编译结果还是会被存放到根目录下的"),t("em",[s._v("target")]),s._v("目录中，而不是"),t("em",[s._v("add/adder/target")]),s._v("目录。Cargo这样组织"),t("em",[s._v("target")]),s._v("目录是因为，工作空间下的包是相互依赖的，如果每个包都有自己的"),t("em",[s._v("target")]),s._v("目录来存放编译结果，则所有的包都需要互相为其他包构建一份。")]),s._v(" "),t("h3",{attrs:{id:"创建第二个包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建第二个包"}},[s._v("#")]),s._v(" 创建第二个包")]),s._v(" "),t("p",[s._v("接下来创建工作空间下的第二个包"),t("code",[s._v("add_one")]),s._v("。修改根目录下的"),t("em",[s._v("Cargo.toml")]),s._v("文件。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("workspace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("members")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"adder"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add-one"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("然后创建一个库crate。"),t("code",[s._v("cargo new add_one --lib")]),s._v("。现在目录应该包含以下内容")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("├── Cargo.lock\n├── Cargo.toml\n├── add-one\n│   ├── Cargo.toml\n│   └── src\n│       └── lib.rs\n├── adder\n│   ├── Cargo.toml\n│   └── src\n│       └── main.rs\n└── target\n")])])]),t("p",[s._v("在"),t("em",[s._v("add-one/src/lib.rs")]),s._v("文件中添加一个"),t("code",[s._v("add_one")]),s._v("函数。")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("i32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("接下来可执行crate可以对库crate进行依赖，首先在需要引入依赖的crate的toml文件中，定义[dependencies]模块。指定库crate的路径。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("add-one")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"../add-one"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("Cargo不会对依赖进行解析，所以需要我们明确指定crate间的依赖关系。")]),s._v(" "),t("p",[s._v("接下来可以在"),t("code",[s._v("adder")]),s._v("crate中通过"),t("code",[s._v("use")]),s._v("引入"),t("code",[s._v("add-one")]),s._v("模块了。")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" add_one"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" num "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, world! {} plus one is {}!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        add_one"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("最后在根目录下运行"),t("code",[s._v("cargo build")]),s._v("构建。使用"),t("code",[s._v("cargo run")]),s._v("命令运行代码，使用"),t("code",[s._v("-p")]),s._v("参数指定运行的包："),t("code",[s._v("cargo run -p adder")]),s._v("。")]),s._v(" "),t("h4",{attrs:{id:"依赖外部包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖外部包"}},[s._v("#")]),s._v(" 依赖外部包")]),s._v(" "),t("p",[s._v("整个工作空间只有根目录下有"),t("em",[s._v("Cargo.lock")]),s._v("文件，这样保证所有包使用的外部依赖都是相同的版本。如果你在每个包目录下的"),t("em",[s._v("Cargo.toml")]),s._v("文件中都指定了外部依赖，Cargo会将他们处理成统一的版本并记录在根目录下的"),t("em",[s._v("Cargo.lock")]),s._v("文件中。这样保证所有包使用的依赖都是兼容的。下面我们先在"),t("em",[s._v("add-one/Cargo.toml")]),s._v("文件中添加一个"),t("code",[s._v("rand")]),s._v("外部依赖。然后在文件中引用这个依赖并执行编译。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("rand")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.5.5"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("  Updating crates.io index\nDownloaded libc v0.2.76\n Compiling rand v0.5.6\n Compiling add-one v0.1.0 (/Users/ksleo/private/add/add-one)\n Compiling adder v0.1.0 (/Users/ksleo/private/add/adder)\n")])])]),t("p",[s._v("现在根目录下的"),t("em",[s._v("Cargo.lock")]),s._v("已经有了"),t("code",[s._v("add-one")]),s._v("依赖"),t("code",[s._v("rand")]),s._v("包的信息。尽管"),t("code",[s._v("rand")]),s._v("包以及在工作空间内部使用了，但是在"),t("code",[s._v("add-one")]),s._v("以外的包中，引入"),t("code",[s._v("rand")]),s._v("包还是会报错，除非我们在他们的"),t("em",[s._v("Cargo.toml")]),s._v("文件中也指定"),t("code",[s._v("rand")]),s._v("依赖。此时"),t("em",[s._v("Cargo.lock")]),s._v("文件中也会记录"),t("code",[s._v("adder")]),s._v("引用"),t("code",[s._v("rand")]),s._v("的信息，但是不会重新下载多余的代码。这种方式既保证所有包都使用同一个版本的外部依赖，又不会因为代码拷贝从而对空间造成浪费。")]),s._v(" "),t("h4",{attrs:{id:"为工作空间添加测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为工作空间添加测试"}},[s._v("#")]),s._v(" 为工作空间添加测试")]),s._v(" "),t("p",[s._v("为"),t("code",[s._v("add-one")]),s._v("包的公有方法添加一个测试用例")]),s._v(" "),t("div",{staticClass:"language-rust line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-rust"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[cfg(test)]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" tests "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[s._v("#[test]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("it_works")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("assert_eq!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("运行"),t("code",[s._v("cargo test")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("    Running target/debug/deps/add_one-f0253159197f7841\nrunning 1 test\ntest tests::it_works ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n\n    Running target/debug/deps/adder-d6b6ef1ba6873bae\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n\n  Doc-tests add-one\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n")])])]),t("p",[s._v("第一块内容表示"),t("code",[s._v("add-one")]),s._v("包有一个测试用例被运行；第二块表示"),t("code",[s._v("adder")]),s._v("包中没有测试用例可以执行；第三块表示"),t("code",[s._v("add-one")]),s._v("包中没有文档测试可以执行。在工作空间中执行测试，会将工作空间下所有包的测试用例都执行。")]),s._v(" "),t("p",[s._v("也可以使用"),t("code",[s._v("-p")]),s._v("参数指定测试的包，与"),t("code",[s._v("cargo run")]),s._v("使用方式一样。")]),s._v(" "),t("p",[s._v("如果你要发布你的包，那么你需要对每个包分别执行发布操作，"),t("code",[s._v("cargo publish")]),s._v("没有"),t("code",[s._v("--all")]),s._v("或者"),t("code",[s._v("-p")]),s._v("参数。")]),s._v(" "),t("h2",{attrs:{id:"section-4-使用cargo-install从crates-io安装可执行文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-4-使用cargo-install从crates-io安装可执行文件"}},[s._v("#")]),s._v(" Section 4 - 使用"),t("code",[s._v("cargo install")]),s._v("从crates.io安装可执行文件")]),s._v(" "),t("p",[t("code",[s._v("cargo install")]),s._v("命令可以让你在本地下载和使用可执行crate。只能安装带有可执行编译目标的包。可执行编译目标是由具有"),t("em",[s._v("src/main.rs")]),s._v("文件，或者其他被指定为可执行文件的包，编译而来的可执行程序。相对应的库crate则不能独立运行，只能被其他crate引用。通常crate都会又README文件说明，crate是可执行crate还是库crate。")]),s._v(" "),t("p",[s._v("可执行文件被下载到安装目录的"),t("em",[s._v("bin")]),s._v("目录下，如果你没有进行过任何自定义配置，这个目录是$HOME/.cargo/bin。确保该路径被添加进"),t("code",[s._v("$PATH")]),s._v("环境变量了，否则可能无法运行可执行文件。")]),s._v(" "),t("h2",{attrs:{id:"section-5-子命令扩展cargo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#section-5-子命令扩展cargo"}},[s._v("#")]),s._v(" Section 5 - 子命令扩展Cargo")]),s._v(" "),t("p",[s._v("Cargo被设计为你不需要修改Cargo本身就可以扩展很多子命令，如果你的"),t("code",[s._v("$PATH")]),s._v("中有个可执行程序叫"),t("code",[s._v("cargo-something")]),s._v("，你可以用类似子命令的方式运行它"),t("code",[s._v("cargo something")]),s._v("。可以通过"),t("code",[s._v("cargo --list")]),s._v("命令列出所有cargo扩展命令。使用"),t("code",[s._v("cargo install")]),s._v("来安装这些可执行扩展，就像使用内置工具一样方便。")])])}),[],!1,null,null,null);a.default=e.exports}}]);